<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
    
  07 在被管理节点上创建文件或目录 - Linux学习站
  
  </title>
 <meta name="description" content="">
 <link href="atom.xml" rel="alternate" title="Linux学习站" type="application/atom+xml">
    <link rel="stylesheet" href="foundation.min.css" tppabs="http://www.itwangqing.net.cn/asset/css/foundation.min.css" />
    <link rel="stylesheet" href="docs.css" tppabs="http://www.itwangqing.net.cn/asset/css/docs.css" />

    <script src="modernizr.js" tppabs="http://www.itwangqing.net.cn/asset/js/vendor/modernizr.js"></script>
    <script src="jquery.js" tppabs="http://www.itwangqing.net.cn/asset/js/vendor/jquery.js"></script>
    <script src="highlight.pack.js" tppabs="http://www.itwangqing.net.cn/asset/highlightjs/highlight.pack.js"></script>
    <link href="github.css" tppabs="http://www.itwangqing.net.cn/asset/highlightjs/styles/github.css" media="screen, projection" rel="stylesheet" type="text/css">
    <script>hljs.initHighlightingOnLoad();</script>
    
  </head>
  <body class="antialiased hide-extras">
    
    <div class="marketing off-canvas-wrap" data-offcanvas>
      <div class="inner-wrap">


<nav class="top-bar docs-bar hide-for-small" data-topbar>

<div id="header">
    <h1><a href="index.html" tppabs="http://www.itwangqing.net.cn/index.html">Linux学习站</a></h1>
</div>

</nav>
        <nav class="tab-bar show-for-small">
  <a href="javascript:void(0)" class="left-off-canvas-toggle menu-icon">
    <span> &nbsp; Linux学习站</span>
  </a>
</nav>

<aside class="left-off-canvas-menu">
      <ul class="off-canvas-list">
      <li><a href="index.html" tppabs="http://www.itwangqing.net.cn/index.html">Home</a></li>
      
        <li class="divider"></li>
        <li><label>系统基础</label></li>

          
            <li><a title="Linux基础一" href="15309530058499.html" tppabs="http://www.itwangqing.net.cn/15309530058499.html">Linux基础一</a></li>
          
            <li><a title="Linux基础二" href="15329593343626.html" tppabs="http://www.itwangqing.net.cn/15329593343626.html">Linux基础二</a></li>
          
            <li><a title="Linux基础三" href="15329666111943.html" tppabs="http://www.itwangqing.net.cn/15329666111943.html">Linux基础三</a></li>
          

      
        <li class="divider"></li>
        <li><label>用户管理</label></li>

          
            <li><a title="用户和组管理" href="15309537287199.html" tppabs="http://www.itwangqing.net.cn/15309537287199.html">用户和组管理</a></li>
          
            <li><a title="权限管理" href="15334773924932.html" tppabs="http://www.itwangqing.net.cn/15334773924932.html">权限管理</a></li>
          

      
        <li class="divider"></li>
        <li><label>文本编辑</label></li>

          
            <li><a title="文本编辑之VIM" href="15334773649600.html" tppabs="http://www.itwangqing.net.cn/15334773649600.html">文本编辑之VIM</a></li>
          

      
        <li class="divider"></li>
        <li><label>进程管理</label></li>

          
            <li><a title="linux进程管理" href="15307008887372.html" tppabs="http://www.itwangqing.net.cn/15307008887372.html">linux进程管理</a></li>
          
            <li><a title="控制服务和守护进程" href="15308770808056.html" tppabs="http://www.itwangqing.net.cn/15308770808056.html">控制服务和守护进程</a></li>
          

      
        <li class="divider"></li>
        <li><label>网络管理</label></li>

          
            <li><a title="网络基础管理" href="15301749310671.html" tppabs="http://www.itwangqing.net.cn/15301749310671.html">网络基础管理</a></li>
          
            <li><a title="网络进阶管理" href="15304407617481.html" tppabs="http://www.itwangqing.net.cn/15304407617481.html">网络进阶管理</a></li>
          

      
        <li class="divider"></li>
        <li><label>软件管理</label></li>

          
            <li><a title="软件管理" href="15298462113678.html" tppabs="http://www.itwangqing.net.cn/15298462113678.html">软件管理</a></li>
          
            <li><a title="yum工具的使用" href="15297662988909.html" tppabs="http://www.itwangqing.net.cn/15297662988909.html">yum工具的使用</a></li>
          
            <li><a title="源码安装包管理" href="15299940709726.html" tppabs="http://www.itwangqing.net.cn/15299940709726.html">源码安装包管理</a></li>
          

      
        <li class="divider"></li>
        <li><label>磁盘管理</label></li>

          
            <li><a title="Linux系统磁盘管理" href="15300107229451.html" tppabs="http://www.itwangqing.net.cn/15300107229451.html">Linux系统磁盘管理</a></li>
          
            <li><a title="LVM管理" href="15301020706680.html" tppabs="http://www.itwangqing.net.cn/15301020706680.html">LVM管理</a></li>
          

      
        <li class="divider"></li>
        <li><label>计划任务</label></li>

          
            <li><a title="linux计划任务管理" href="15306026605931.html" tppabs="http://www.itwangqing.net.cn/15306026605931.html">linux计划任务管理</a></li>
          

      
        <li class="divider"></li>
        <li><label>shell脚本</label></li>

          
            <li><a title="shell脚本基础" href="15326519927588.html" tppabs="http://www.itwangqing.net.cn/15326519927588.html">shell脚本基础</a></li>
          
            <li><a title="shell脚本进阶" href="15326563612690.html" tppabs="http://www.itwangqing.net.cn/15326563612690.html">shell脚本进阶</a></li>
          
            <li><a title="正则表达式" href="15309531529503.html" tppabs="http://www.itwangqing.net.cn/15309531529503.html">正则表达式</a></li>
          

      
        <li class="divider"></li>
        <li><label>服务管理</label></li>

          
            <li><a title="openssh" href="15309540565109.html" tppabs="http://www.itwangqing.net.cn/15309540565109.html">openssh</a></li>
          
            <li><a title="NFS" href="15331149680339.html" tppabs="http://www.itwangqing.net.cn/15331149680339.html">NFS</a></li>
          
            <li><a title="samba" href="15332084684114.html" tppabs="http://www.itwangqing.net.cn/15332084684114.html">samba</a></li>
          
            <li><a title="ftp" href="15331235945908.html" tppabs="http://www.itwangqing.net.cn/15331235945908.html">ftp</a></li>
          
            <li><a title="httpd" href="15333747858558.html" tppabs="http://www.itwangqing.net.cn/15333747858558.html">httpd</a></li>
          
            <li><a title="rsync" href="15336422692695.html" tppabs="http://www.itwangqing.net.cn/15336422692695.html">rsync</a></li>
          
            <li><a title="mysql基础" href="15340549469789.html" tppabs="http://www.itwangqing.net.cn/15340549469789.html">mysql基础</a></li>
          
            <li><a title="mysql进阶" href="15340747137714.html" tppabs="http://www.itwangqing.net.cn/15340747137714.html">mysql进阶</a></li>
          
            <li><a title="mysql多实例部署" href="15574501454471.html" tppabs="http://www.itwangqing.net.cn/15574501454471.html">mysql多实例部署</a></li>
          
            <li><a title="lamp" href="15343825969129.html" tppabs="http://www.itwangqing.net.cn/15343825969129.html">lamp</a></li>
          
            <li><a title="mysql主从" href="15340760215942.html" tppabs="http://www.itwangqing.net.cn/15340760215942.html">mysql主从</a></li>
          
            <li><a title="监控服务zabbix部署" href="15344093145314.html" tppabs="http://www.itwangqing.net.cn/15344093145314.html">监控服务zabbix部署</a></li>
          
            <li><a title="nginx" href="15347293082090.html" tppabs="http://www.itwangqing.net.cn/15347293082090.html">nginx</a></li>
          
            <li><a title="cobbler" href="15348344859945.html" tppabs="http://www.itwangqing.net.cn/15348344859945.html">cobbler</a></li>
          
            <li><a title="版本控制gitlab" href="15350227215553.html" tppabs="http://www.itwangqing.net.cn/15350227215553.html">版本控制gitlab</a></li>
          
            <li><a title="tomcat" href="15350951162147.html" tppabs="http://www.itwangqing.net.cn/15350951162147.html">tomcat</a></li>
          
            <li><a title="kvm虚拟化" href="15397735724181.html" tppabs="http://www.itwangqing.net.cn/15397735724181.html">kvm虚拟化</a></li>
          
            <li><a title="keepalived高可用" href="15399319450072.html" tppabs="http://www.itwangqing.net.cn/15399319450072.html">keepalived高可用</a></li>
          
            <li><a title="mysql中间件proxysql实现mysql读写分离" href="15421935147049.html" tppabs="http://www.itwangqing.net.cn/15421935147049.html">mysql中间件proxysql实现mysql读写分离</a></li>
          
            <li><a title="开源堡垒机Jumpserver" href="15671624164646.html" tppabs="http://www.itwangqing.net.cn/15671624164646.html">开源堡垒机Jumpserver</a></li>
          
            <li><a title="haproxy" href="15833949737143.html" tppabs="http://www.itwangqing.net.cn/15833949737143.html">haproxy</a></li>
          

      
        <li class="divider"></li>
        <li><label>自动化运维工具ansible</label></li>

          
            <li><a title="01 Ansible介绍与安装" href="15899421412937.html" tppabs="http://www.itwangqing.net.cn/15899421412937.html">01 Ansible介绍与安装</a></li>
          
            <li><a title="02 部署Ansible" href="15899422975885.html" tppabs="http://www.itwangqing.net.cn/15899422975885.html">02 部署Ansible</a></li>
          
            <li><a title="03 ansible常用模块" href="15360459655433.html" tppabs="http://www.itwangqing.net.cn/15360459655433.html">03 ansible常用模块</a></li>
          
            <li><a title="04 playbook" href="15900337310825.html" tppabs="http://www.itwangqing.net.cn/15900337310825.html">04 playbook</a></li>
          
            <li><a title="05 管理变量、机密和事实" href="15902192327327.html" tppabs="http://www.itwangqing.net.cn/15902192327327.html">05 管理变量、机密和事实</a></li>
          
            <li><a title="06 实施任务控制" href="15904785155492.html" tppabs="http://www.itwangqing.net.cn/15904785155492.html">06 实施任务控制</a></li>
          
            <li><a title="07 在被管理节点上创建文件或目录" href="15909932604247.html" tppabs="http://www.itwangqing.net.cn/15909932604247.html">07 在被管理节点上创建文件或目录</a></li>
          
            <li><a title="08 管理大项目" href="15916866139753.html" tppabs="http://www.itwangqing.net.cn/15916866139753.html">08 管理大项目</a></li>
          

      
        <li class="divider"></li>
        <li><label>自动化运维工具saltstack</label></li>

          
            <li><a title="01 SaltStack入门" href="15505624542032.html" tppabs="http://www.itwangqing.net.cn/15505624542032.html">01 SaltStack入门</a></li>
          
            <li><a title="02 SaltStack之配置管理" href="15505739253069.html" tppabs="http://www.itwangqing.net.cn/15505739253069.html">02 SaltStack之配置管理</a></li>
          
            <li><a title="03 SaltStack之数据系统" href="15506476021123.html" tppabs="http://www.itwangqing.net.cn/15506476021123.html">03 SaltStack之数据系统</a></li>
          
            <li><a title="04 SaltStack常用的模块" href="15506647066554.html" tppabs="http://www.itwangqing.net.cn/15506647066554.html">04 SaltStack常用的模块</a></li>
          
            <li><a title="05 SaltStack之return与job管理" href="15518677780073.html" tppabs="http://www.itwangqing.net.cn/15518677780073.html">05 SaltStack之return与job管理</a></li>
          
            <li><a title="06 SaltStack之salt-ssh" href="15520269709477.html" tppabs="http://www.itwangqing.net.cn/15520269709477.html">06 SaltStack之salt-ssh</a></li>
          
            <li><a title="07 SaltStack进阶" href="15537606512093.html" tppabs="http://www.itwangqing.net.cn/15537606512093.html">07 SaltStack进阶</a></li>
          

      
        <li class="divider"></li>
        <li><label>docker</label></li>

          
            <li><a title="docker容器技术基础入门" href="15756156871621.html" tppabs="http://www.itwangqing.net.cn/15756156871621.html">docker容器技术基础入门</a></li>
          
            <li><a title="docker基础用法" href="15808961165162.html" tppabs="http://www.itwangqing.net.cn/15808961165162.html">docker基础用法</a></li>
          
            <li><a title="docker镜像管理基础" href="15809107453374.html" tppabs="http://www.itwangqing.net.cn/15809107453374.html">docker镜像管理基础</a></li>
          
            <li><a title="docker容器虚拟化" href="15811500963775.html" tppabs="http://www.itwangqing.net.cn/15811500963775.html">docker容器虚拟化</a></li>
          
            <li><a title="docker容器网络" href="15812176196320.html" tppabs="http://www.itwangqing.net.cn/15812176196320.html">docker容器网络</a></li>
          
            <li><a title="docker容器网络配置" href="15812236429133.html" tppabs="http://www.itwangqing.net.cn/15812236429133.html">docker容器网络配置</a></li>
          
            <li><a title="docker存储卷" href="15812406178865.html" tppabs="http://www.itwangqing.net.cn/15812406178865.html">docker存储卷</a></li>
          
            <li><a title="Dockerfile" href="15820930531496.html" tppabs="http://www.itwangqing.net.cn/15820930531496.html">Dockerfile</a></li>
          
            <li><a title="Docker Private Registry" href="15823545783647.html" tppabs="http://www.itwangqing.net.cn/15823545783647.html">Docker Private Registry</a></li>
          

      
        <li class="divider"></li>
        <li><label>作业题</label></li>

          
            <li><a title="vim练习" href="15312221747200.html" tppabs="http://www.itwangqing.net.cn/15312221747200.html">vim练习</a></li>
          
            <li><a title="基础练习" href="15308359538636.html" tppabs="http://www.itwangqing.net.cn/15308359538636.html">基础练习</a></li>
          
            <li><a title="系统管理基础综合练习" href="15312664196054.html" tppabs="http://www.itwangqing.net.cn/15312664196054.html">系统管理基础综合练习</a></li>
          
            <li><a title="shell脚本习题" href="15395707987789.html" tppabs="http://www.itwangqing.net.cn/15395707987789.html">shell脚本习题</a></li>
          
            <li><a title="Linux运维面试题" href="15396808887591.html" tppabs="http://www.itwangqing.net.cn/15396808887591.html">Linux运维面试题</a></li>
          

      
        <li class="divider"></li>
        <li><label>python</label></li>

          
            <li><a title="python介绍" href="15538297742581.html" tppabs="http://www.itwangqing.net.cn/15538297742581.html">python介绍</a></li>
          
            <li><a title="Python入门" href="15540177360572.html" tppabs="http://www.itwangqing.net.cn/15540177360572.html">Python入门</a></li>
          
            <li><a title="变量与字符编码" href="15615383234174.html" tppabs="http://www.itwangqing.net.cn/15615383234174.html">变量与字符编码</a></li>
          
            <li><a title="Python编程规范、运算符" href="15616166878859.html" tppabs="http://www.itwangqing.net.cn/15616166878859.html">Python编程规范、运算符</a></li>
          
            <li><a title="流程控制与格式化输出" href="15616375345555.html" tppabs="http://www.itwangqing.net.cn/15616375345555.html">流程控制与格式化输出</a></li>
          
            <li><a title="数据类型" href="15617044071511.html" tppabs="http://www.itwangqing.net.cn/15617044071511.html">数据类型</a></li>
          
            <li><a title="文件管理" href="15646303312857.html" tppabs="http://www.itwangqing.net.cn/15646303312857.html">文件管理</a></li>
          
            <li><a title="函数从入门到超神" href="15621339486509.html" tppabs="http://www.itwangqing.net.cn/15621339486509.html">函数从入门到超神</a></li>
          
            <li><a title="列表生成式、迭代器与生成器" href="15652344516454.html" tppabs="http://www.itwangqing.net.cn/15652344516454.html">列表生成式、迭代器与生成器</a></li>
          
            <li><a title="模块与包" href="15621538343767.html" tppabs="http://www.itwangqing.net.cn/15621538343767.html">模块与包</a></li>
          
            <li><a title="常用内置模块" href="15622250202368.html" tppabs="http://www.itwangqing.net.cn/15622250202368.html">常用内置模块</a></li>
          
            <li><a title="日志模块logging" href="15658313775832.html" tppabs="http://www.itwangqing.net.cn/15658313775832.html">日志模块logging</a></li>
          
            <li><a title="正则表达式re模块" href="15623206542335.html" tppabs="http://www.itwangqing.net.cn/15623206542335.html">正则表达式re模块</a></li>
          
            <li><a title="Python爬虫实战：链家二手房" href="15635212817346.html" tppabs="http://www.itwangqing.net.cn/15635212817346.html">Python爬虫实战：链家二手房</a></li>
          
            <li><a title="数据可视化分析" href="15632679626574.html" tppabs="http://www.itwangqing.net.cn/15632679626574.html">数据可视化分析</a></li>
          

      
      </ul>
    </aside>

<a class="exit-off-canvas" href="#"></a>

        <section id="main-content" role="main" class="scroll-container">

          <div class="row">
            <div class="large-3 medium-3 columns">
              <div class="hide-for-small">
                <div class="sidebar">
                <nav>
                  <ul id="side-nav" class="side-nav">

                    
                      <li class="side-title"><span>系统基础</span></li>
                        
                          <li><a title="Linux基础一" href="15309530058499.html" tppabs="http://www.itwangqing.net.cn/15309530058499.html">Linux基础一</a></li>
                        
                          <li><a title="Linux基础二" href="15329593343626.html" tppabs="http://www.itwangqing.net.cn/15329593343626.html">Linux基础二</a></li>
                        
                          <li><a title="Linux基础三" href="15329666111943.html" tppabs="http://www.itwangqing.net.cn/15329666111943.html">Linux基础三</a></li>
                        

                    
                      <li class="side-title"><span>用户管理</span></li>
                        
                          <li><a title="用户和组管理" href="15309537287199.html" tppabs="http://www.itwangqing.net.cn/15309537287199.html">用户和组管理</a></li>
                        
                          <li><a title="权限管理" href="15334773924932.html" tppabs="http://www.itwangqing.net.cn/15334773924932.html">权限管理</a></li>
                        

                    
                      <li class="side-title"><span>文本编辑</span></li>
                        
                          <li><a title="文本编辑之VIM" href="15334773649600.html" tppabs="http://www.itwangqing.net.cn/15334773649600.html">文本编辑之VIM</a></li>
                        

                    
                      <li class="side-title"><span>进程管理</span></li>
                        
                          <li><a title="linux进程管理" href="15307008887372.html" tppabs="http://www.itwangqing.net.cn/15307008887372.html">linux进程管理</a></li>
                        
                          <li><a title="控制服务和守护进程" href="15308770808056.html" tppabs="http://www.itwangqing.net.cn/15308770808056.html">控制服务和守护进程</a></li>
                        

                    
                      <li class="side-title"><span>网络管理</span></li>
                        
                          <li><a title="网络基础管理" href="15301749310671.html" tppabs="http://www.itwangqing.net.cn/15301749310671.html">网络基础管理</a></li>
                        
                          <li><a title="网络进阶管理" href="15304407617481.html" tppabs="http://www.itwangqing.net.cn/15304407617481.html">网络进阶管理</a></li>
                        

                    
                      <li class="side-title"><span>软件管理</span></li>
                        
                          <li><a title="软件管理" href="15298462113678.html" tppabs="http://www.itwangqing.net.cn/15298462113678.html">软件管理</a></li>
                        
                          <li><a title="yum工具的使用" href="15297662988909.html" tppabs="http://www.itwangqing.net.cn/15297662988909.html">yum工具的使用</a></li>
                        
                          <li><a title="源码安装包管理" href="15299940709726.html" tppabs="http://www.itwangqing.net.cn/15299940709726.html">源码安装包管理</a></li>
                        

                    
                      <li class="side-title"><span>磁盘管理</span></li>
                        
                          <li><a title="Linux系统磁盘管理" href="15300107229451.html" tppabs="http://www.itwangqing.net.cn/15300107229451.html">Linux系统磁盘管理</a></li>
                        
                          <li><a title="LVM管理" href="15301020706680.html" tppabs="http://www.itwangqing.net.cn/15301020706680.html">LVM管理</a></li>
                        

                    
                      <li class="side-title"><span>计划任务</span></li>
                        
                          <li><a title="linux计划任务管理" href="15306026605931.html" tppabs="http://www.itwangqing.net.cn/15306026605931.html">linux计划任务管理</a></li>
                        

                    
                      <li class="side-title"><span>shell脚本</span></li>
                        
                          <li><a title="shell脚本基础" href="15326519927588.html" tppabs="http://www.itwangqing.net.cn/15326519927588.html">shell脚本基础</a></li>
                        
                          <li><a title="shell脚本进阶" href="15326563612690.html" tppabs="http://www.itwangqing.net.cn/15326563612690.html">shell脚本进阶</a></li>
                        
                          <li><a title="正则表达式" href="15309531529503.html" tppabs="http://www.itwangqing.net.cn/15309531529503.html">正则表达式</a></li>
                        

                    
                      <li class="side-title"><span>服务管理</span></li>
                        
                          <li><a title="openssh" href="15309540565109.html" tppabs="http://www.itwangqing.net.cn/15309540565109.html">openssh</a></li>
                        
                          <li><a title="NFS" href="15331149680339.html" tppabs="http://www.itwangqing.net.cn/15331149680339.html">NFS</a></li>
                        
                          <li><a title="samba" href="15332084684114.html" tppabs="http://www.itwangqing.net.cn/15332084684114.html">samba</a></li>
                        
                          <li><a title="ftp" href="15331235945908.html" tppabs="http://www.itwangqing.net.cn/15331235945908.html">ftp</a></li>
                        
                          <li><a title="httpd" href="15333747858558.html" tppabs="http://www.itwangqing.net.cn/15333747858558.html">httpd</a></li>
                        
                          <li><a title="rsync" href="15336422692695.html" tppabs="http://www.itwangqing.net.cn/15336422692695.html">rsync</a></li>
                        
                          <li><a title="mysql基础" href="15340549469789.html" tppabs="http://www.itwangqing.net.cn/15340549469789.html">mysql基础</a></li>
                        
                          <li><a title="mysql进阶" href="15340747137714.html" tppabs="http://www.itwangqing.net.cn/15340747137714.html">mysql进阶</a></li>
                        
                          <li><a title="mysql多实例部署" href="15574501454471.html" tppabs="http://www.itwangqing.net.cn/15574501454471.html">mysql多实例部署</a></li>
                        
                          <li><a title="lamp" href="15343825969129.html" tppabs="http://www.itwangqing.net.cn/15343825969129.html">lamp</a></li>
                        
                          <li><a title="mysql主从" href="15340760215942.html" tppabs="http://www.itwangqing.net.cn/15340760215942.html">mysql主从</a></li>
                        
                          <li><a title="监控服务zabbix部署" href="15344093145314.html" tppabs="http://www.itwangqing.net.cn/15344093145314.html">监控服务zabbix部署</a></li>
                        
                          <li><a title="nginx" href="15347293082090.html" tppabs="http://www.itwangqing.net.cn/15347293082090.html">nginx</a></li>
                        
                          <li><a title="cobbler" href="15348344859945.html" tppabs="http://www.itwangqing.net.cn/15348344859945.html">cobbler</a></li>
                        
                          <li><a title="版本控制gitlab" href="15350227215553.html" tppabs="http://www.itwangqing.net.cn/15350227215553.html">版本控制gitlab</a></li>
                        
                          <li><a title="tomcat" href="15350951162147.html" tppabs="http://www.itwangqing.net.cn/15350951162147.html">tomcat</a></li>
                        
                          <li><a title="kvm虚拟化" href="15397735724181.html" tppabs="http://www.itwangqing.net.cn/15397735724181.html">kvm虚拟化</a></li>
                        
                          <li><a title="keepalived高可用" href="15399319450072.html" tppabs="http://www.itwangqing.net.cn/15399319450072.html">keepalived高可用</a></li>
                        
                          <li><a title="mysql中间件proxysql实现mysql读写分离" href="15421935147049.html" tppabs="http://www.itwangqing.net.cn/15421935147049.html">mysql中间件proxysql实现mysql读写分离</a></li>
                        
                          <li><a title="开源堡垒机Jumpserver" href="15671624164646.html" tppabs="http://www.itwangqing.net.cn/15671624164646.html">开源堡垒机Jumpserver</a></li>
                        
                          <li><a title="haproxy" href="15833949737143.html" tppabs="http://www.itwangqing.net.cn/15833949737143.html">haproxy</a></li>
                        

                    
                      <li class="side-title"><span>自动化运维工具ansible</span></li>
                        
                          <li><a title="01 Ansible介绍与安装" href="15899421412937.html" tppabs="http://www.itwangqing.net.cn/15899421412937.html">01 Ansible介绍与安装</a></li>
                        
                          <li><a title="02 部署Ansible" href="15899422975885.html" tppabs="http://www.itwangqing.net.cn/15899422975885.html">02 部署Ansible</a></li>
                        
                          <li><a title="03 ansible常用模块" href="15360459655433.html" tppabs="http://www.itwangqing.net.cn/15360459655433.html">03 ansible常用模块</a></li>
                        
                          <li><a title="04 playbook" href="15900337310825.html" tppabs="http://www.itwangqing.net.cn/15900337310825.html">04 playbook</a></li>
                        
                          <li><a title="05 管理变量、机密和事实" href="15902192327327.html" tppabs="http://www.itwangqing.net.cn/15902192327327.html">05 管理变量、机密和事实</a></li>
                        
                          <li><a title="06 实施任务控制" href="15904785155492.html" tppabs="http://www.itwangqing.net.cn/15904785155492.html">06 实施任务控制</a></li>
                        
                          <li><a title="07 在被管理节点上创建文件或目录" href="15909932604247.html" tppabs="http://www.itwangqing.net.cn/15909932604247.html">07 在被管理节点上创建文件或目录</a></li>
                        
                          <li><a title="08 管理大项目" href="15916866139753.html" tppabs="http://www.itwangqing.net.cn/15916866139753.html">08 管理大项目</a></li>
                        

                    
                      <li class="side-title"><span>自动化运维工具saltstack</span></li>
                        
                          <li><a title="01 SaltStack入门" href="15505624542032.html" tppabs="http://www.itwangqing.net.cn/15505624542032.html">01 SaltStack入门</a></li>
                        
                          <li><a title="02 SaltStack之配置管理" href="15505739253069.html" tppabs="http://www.itwangqing.net.cn/15505739253069.html">02 SaltStack之配置管理</a></li>
                        
                          <li><a title="03 SaltStack之数据系统" href="15506476021123.html" tppabs="http://www.itwangqing.net.cn/15506476021123.html">03 SaltStack之数据系统</a></li>
                        
                          <li><a title="04 SaltStack常用的模块" href="15506647066554.html" tppabs="http://www.itwangqing.net.cn/15506647066554.html">04 SaltStack常用的模块</a></li>
                        
                          <li><a title="05 SaltStack之return与job管理" href="15518677780073.html" tppabs="http://www.itwangqing.net.cn/15518677780073.html">05 SaltStack之return与job管理</a></li>
                        
                          <li><a title="06 SaltStack之salt-ssh" href="15520269709477.html" tppabs="http://www.itwangqing.net.cn/15520269709477.html">06 SaltStack之salt-ssh</a></li>
                        
                          <li><a title="07 SaltStack进阶" href="15537606512093.html" tppabs="http://www.itwangqing.net.cn/15537606512093.html">07 SaltStack进阶</a></li>
                        

                    
                      <li class="side-title"><span>docker</span></li>
                        
                          <li><a title="docker容器技术基础入门" href="15756156871621.html" tppabs="http://www.itwangqing.net.cn/15756156871621.html">docker容器技术基础入门</a></li>
                        
                          <li><a title="docker基础用法" href="15808961165162.html" tppabs="http://www.itwangqing.net.cn/15808961165162.html">docker基础用法</a></li>
                        
                          <li><a title="docker镜像管理基础" href="15809107453374.html" tppabs="http://www.itwangqing.net.cn/15809107453374.html">docker镜像管理基础</a></li>
                        
                          <li><a title="docker容器虚拟化" href="15811500963775.html" tppabs="http://www.itwangqing.net.cn/15811500963775.html">docker容器虚拟化</a></li>
                        
                          <li><a title="docker容器网络" href="15812176196320.html" tppabs="http://www.itwangqing.net.cn/15812176196320.html">docker容器网络</a></li>
                        
                          <li><a title="docker容器网络配置" href="15812236429133.html" tppabs="http://www.itwangqing.net.cn/15812236429133.html">docker容器网络配置</a></li>
                        
                          <li><a title="docker存储卷" href="15812406178865.html" tppabs="http://www.itwangqing.net.cn/15812406178865.html">docker存储卷</a></li>
                        
                          <li><a title="Dockerfile" href="15820930531496.html" tppabs="http://www.itwangqing.net.cn/15820930531496.html">Dockerfile</a></li>
                        
                          <li><a title="Docker Private Registry" href="15823545783647.html" tppabs="http://www.itwangqing.net.cn/15823545783647.html">Docker Private Registry</a></li>
                        

                    
                      <li class="side-title"><span>作业题</span></li>
                        
                          <li><a title="vim练习" href="15312221747200.html" tppabs="http://www.itwangqing.net.cn/15312221747200.html">vim练习</a></li>
                        
                          <li><a title="基础练习" href="15308359538636.html" tppabs="http://www.itwangqing.net.cn/15308359538636.html">基础练习</a></li>
                        
                          <li><a title="系统管理基础综合练习" href="15312664196054.html" tppabs="http://www.itwangqing.net.cn/15312664196054.html">系统管理基础综合练习</a></li>
                        
                          <li><a title="shell脚本习题" href="15395707987789.html" tppabs="http://www.itwangqing.net.cn/15395707987789.html">shell脚本习题</a></li>
                        
                          <li><a title="Linux运维面试题" href="15396808887591.html" tppabs="http://www.itwangqing.net.cn/15396808887591.html">Linux运维面试题</a></li>
                        

                    
                      <li class="side-title"><span>python</span></li>
                        
                          <li><a title="python介绍" href="15538297742581.html" tppabs="http://www.itwangqing.net.cn/15538297742581.html">python介绍</a></li>
                        
                          <li><a title="Python入门" href="15540177360572.html" tppabs="http://www.itwangqing.net.cn/15540177360572.html">Python入门</a></li>
                        
                          <li><a title="变量与字符编码" href="15615383234174.html" tppabs="http://www.itwangqing.net.cn/15615383234174.html">变量与字符编码</a></li>
                        
                          <li><a title="Python编程规范、运算符" href="15616166878859.html" tppabs="http://www.itwangqing.net.cn/15616166878859.html">Python编程规范、运算符</a></li>
                        
                          <li><a title="流程控制与格式化输出" href="15616375345555.html" tppabs="http://www.itwangqing.net.cn/15616375345555.html">流程控制与格式化输出</a></li>
                        
                          <li><a title="数据类型" href="15617044071511.html" tppabs="http://www.itwangqing.net.cn/15617044071511.html">数据类型</a></li>
                        
                          <li><a title="文件管理" href="15646303312857.html" tppabs="http://www.itwangqing.net.cn/15646303312857.html">文件管理</a></li>
                        
                          <li><a title="函数从入门到超神" href="15621339486509.html" tppabs="http://www.itwangqing.net.cn/15621339486509.html">函数从入门到超神</a></li>
                        
                          <li><a title="列表生成式、迭代器与生成器" href="15652344516454.html" tppabs="http://www.itwangqing.net.cn/15652344516454.html">列表生成式、迭代器与生成器</a></li>
                        
                          <li><a title="模块与包" href="15621538343767.html" tppabs="http://www.itwangqing.net.cn/15621538343767.html">模块与包</a></li>
                        
                          <li><a title="常用内置模块" href="15622250202368.html" tppabs="http://www.itwangqing.net.cn/15622250202368.html">常用内置模块</a></li>
                        
                          <li><a title="日志模块logging" href="15658313775832.html" tppabs="http://www.itwangqing.net.cn/15658313775832.html">日志模块logging</a></li>
                        
                          <li><a title="正则表达式re模块" href="15623206542335.html" tppabs="http://www.itwangqing.net.cn/15623206542335.html">正则表达式re模块</a></li>
                        
                          <li><a title="Python爬虫实战：链家二手房" href="15635212817346.html" tppabs="http://www.itwangqing.net.cn/15635212817346.html">Python爬虫实战：链家二手房</a></li>
                        
                          <li><a title="数据可视化分析" href="15632679626574.html" tppabs="http://www.itwangqing.net.cn/15632679626574.html">数据可视化分析</a></li>
                        

                    
                  </ul>
                </nav>
                </div>
              </div>
            </div>
            <div class="large-9 medium-9 columns">

 <div class="markdown-body">
<h1>07 在被管理节点上创建文件或目录</h1>

<ul>
<li>
<a href="#toc_0">1. 修改文件并将其复制到主机</a>
<ul>
<li>
<a href="#toc_1">1.1 描述文件模块</a>
</li>
<li>
<a href="#toc_2">1.2 files模块的自动化示例</a>
<ul>
<li>
<a href="#toc_3">1.2.1 确保受管主机上存在文件</a>
</li>
<li>
<a href="#toc_4">1.2.2 修改文件属性</a>
</li>
<li>
<a href="#toc_5">1.2.3 使SELinux文件上下文更改具有持久性</a>
</li>
<li>
<a href="#toc_6">1.2.4 在受管主机上复制和编辑文件</a>
</li>
<li>
<a href="#toc_7">1.2.5 从受管主机中删除文件</a>
</li>
<li>
<a href="#toc_8">1.2.6 检索受管主机上的文件状态</a>
</li>
<li>
<a href="#toc_9">1.2.7 同步控制节点和受管主机之间的文件</a>
</li>
</ul>
</li>
</ul>
</li>
<li>
<a href="#toc_10">2. 使用jinja2模板部署自定义文件</a>
<ul>
<li>
<a href="#toc_11">2.1 jinja2简介</a>
</li>
<li>
<a href="#toc_12">2.2 构建jinja2模板</a>
</li>
<li>
<a href="#toc_13">2.3 部署jinja2模板</a>
</li>
<li>
<a href="#toc_14">2.4 管理模板文件</a>
</li>
<li>
<a href="#toc_15">2.5 控制结构</a>
<ul>
<li>
<a href="#toc_16">2.5.1 使用循环</a>
</li>
<li>
<a href="#toc_17">2.5.2 使用条件句</a>
</li>
<li>
<a href="#toc_18">2.5.3 变量过滤器</a>
</li>
<li>
<a href="#toc_19">2.5.4 变量测试</a>
</li>
</ul>
</li>
</ul>
</li>
</ul>


<hr/>

<h2 id="toc_0">1. 修改文件并将其复制到主机</h2>

<h3 id="toc_1">1.1 描述文件模块</h3>

<p>Files模块库包含的模块允许用户完成与Linux文件管理相关的大多数任务，如创建、复制、编辑和修改文件的权限和其他属性。下表提供了常用文件管理模块的列表：</p>

<p><strong>常用文件模块</strong></p>

<table>
<thead>
<tr>
<th>模块名称</th>
<th>模块说明</th>
</tr>
</thead>

<tbody>
<tr>
<td>blockinfile</td>
<td>插入、更新或删除由可自定义标记线包围的多行文本块</td>
</tr>
<tr>
<td>copy</td>
<td>将文件从本地或远程计算机复制到受管主机上的某个位置。<br>类似于<strong>file</strong>模块，<strong>copy</strong>模块还可以设置文件属性，包括SELinux上下文件。</td>
</tr>
<tr>
<td>fetch</td>
<td>此模块的作用和<strong>copy</strong>模块类似，但以相反方式工作。此模块用于从远程计算机获取文件到控制节点，<br>并将它们存储在按主机名组织的文件树中。</td>
</tr>
<tr>
<td>file</td>
<td>设置权限、所有权、SELinux上下文以及常规文件、符号链接、硬链接和目录的时间戳等属性。<br>此模块还可以创建或删除常规文件、符号链接、硬链接和目录。其他多个与文件相关的<br>模块支持与<strong>file</strong>模块相同的属性设置选项，包括<strong>copy</strong>模块。</td>
</tr>
<tr>
<td>lineinfile</td>
<td>确保特定行位于某文件中，或使用反向引用正则表达式来替换现有行。<br>此模块主要在用户想要更改文件的某一行时使用。</td>
</tr>
<tr>
<td>stat</td>
<td>检索文件的状态信息，类似于Linux中的<strong>stat</strong>命令。</td>
</tr>
<tr>
<td>synchronize</td>
<td>围绕<strong>rsync</strong>命令的一个打包程序，可加快和简化常见任务。<br>synchronize模块无法提供对<strong>rsync</strong>命令的完整功能的访问权限，但确实最常见的调用更容易实施。<br>用户可能仍需通过<strong>run command</strong>模块直接调用<strong>rsync</strong>命令。</td>
</tr>
</tbody>
</table>

<h3 id="toc_2">1.2 files模块的自动化示例</h3>

<p>在受管主机上创建、复制、编辑和删除文件是用户可以使用Files模块库中的模块实施的常见任务。<br/>
以下示例显示了可以使用这些模块自动执行常见文件管理任务的方式。</p>

<h4 id="toc_3">1.2.1 确保受管主机上存在文件</h4>

<p>使用<strong>file</strong>模块处理受管主机上的文件。其工作方式与<strong>touch</strong>命令类似，如果不存在则创建一个空文件，如果存在，则更新其修改时间。在本例中，除了处理文件之外，Ansible还确保将文件的所有者、组和权限设置为特定值。</p>

<pre><code class="language-text">- name: Touch a file and set permissions
  file:
    path: /path/to/file
    owner: user1
    group: group1
    mode: 0640
    state: touch
</code></pre>

<h4 id="toc_4">1.2.2 修改文件属性</h4>

<p>使用<strong>file</strong>模块还可以确保新的或现有的文件具有正确的权限和SELinux类型。</p>

<p>例如，以下文件保留了相对于用户主目录的默认SELinux上下文，这不是所需的上下文。</p>

<pre><code class="language-text">[root@localhost ~]# ls -Z samba_file
- rw-r--r-- owner group unconfined_u:object_r:user_home_t:s0 samba_file
</code></pre>

<p>以下任务确保了<strong>anaconda-ks.cfg</strong>文件的SELinux上下文件类型属性是所需的<strong>samba_share_t</strong>类型。此行为与Linux中的<strong>chcon</strong>命令类似。</p>

<pre><code class="language-text">- name: SELinux type is set to samba_share_t
  file:
    path: /path/to/samba_file
    setype: samba_share_t
</code></pre>

<p>示例结果：</p>

<pre><code class="language-text">[root@localhost ~]# ls -Z samba_file
- rw-r--r-- owner group unconfined_u:object_r:samba_share_t:s0 samba_file
</code></pre>

<p>文件属性参数在多个文件管理模块中可用。运行<strong>ansible-doc file</strong>和<strong>ansible-doc copy</strong>命令以获取其他信息。</p>

<h4 id="toc_5">1.2.3 使SELinux文件上下文更改具有持久性</h4>

<p>设置文件上下文时，<strong>file</strong>模块的行为与<strong>chcon</strong>类似。通过运行<strong>restorecon</strong>，可能会意外地撤消使用该模块所做的更改。使用<strong>file</strong>设置上下文后，用户可以使用<strong>system</strong>模块集合中的<strong>sefcontext</strong>来更新SELinux策略，如<strong>semanage fcontext</strong>。</p>

<pre><code class="language-text">- name: SELinux type is persistently set to samba_share_t
  sefcontext:
    target: /path/to/samba_file
    setype: samba_share_t
    state: present
</code></pre>

<p>注意：<strong>sefcontext</strong>模块更新SELinux策略中目标的默认上下文，但不更改现有文件的上下文。</p>

<h4 id="toc_6">1.2.4 在受管主机上复制和编辑文件</h4>

<p>在此示例中，<strong>copy</strong>模块用于将位于控制节点上的Ansible工作目录中的文件复制到选定的受管主机。</p>

<p>默认情况下，此模块假定设置了<strong>force: yes</strong>。这会强制该模块覆盖远程文件（如果存在但包含与正在复制的文件不同的内容）。如果设置<strong>force: no</strong>，则它仅会将该文件复制到受管主机（如果该文件尚不存在）。</p>

<pre><code class="language-text">- name: Copy a file to managed hosts
  copy:
    src: file
    dest: /path/to/file
</code></pre>

<p>要从受管主机检索文件，请使用<strong>fetch</strong>模块。这可用于在将参考系统分发给其他受管主机之前从参考系统中检查诸如SSH公钥之类的文件。</p>

<pre><code class="language-text">- name: Retrieve SSH key from reference host
  fetch:
    src: &quot;/home/{{ user }}/.ssh/id_rsa.pub&quot;
    dest: &quot;files/keys/{{ user }}.pub&quot;
</code></pre>

<p>要确保现有文件中存在特定的单行文本，请使用<strong>lineinfile</strong>模块：</p>

<pre><code class="language-text">- name: Add a line of text to a file
  lineinfile:
    path: /path/to/file
    line: &#39;Add this line to the file&#39;
    state: present
</code></pre>

<p>要将文本块添加到现有文件，请使用<strong>blockinfile</strong>模块：</p>

<pre><code class="language-text">- name: Add additional lines to a file
  blockinfile:
    path: /path/to/file
    block: |
      First line in the additional block of text
      Second line in the additional block of text
    state: present
</code></pre>

<p>注意：使用<strong>blockinfile</strong>模块时，注释块标记插入到块的开头和结尾，以确保幂等性。</p>

<pre><code class="language-text"># BEGIN ANSIBLE MANAGED BLOCK
First line in the additional block of text
Second line in the additional block of text
# END ANSIBLE MANAGED BLOCK
</code></pre>

<p>用户可以使用该模块的<strong>marker</strong>参数，帮助确保将正确的注释字符或文本用于相关文件。</p>

<h4 id="toc_7">1.2.5 从受管主机中删除文件</h4>

<p>从受管主机中删除文件的基本示例是使用<strong>file</strong>模块和<strong>state: absent</strong>参数。<strong>state</strong>参数对于许多模块是可选的。一些模块也支持其他选项。</p>

<pre><code class="language-text">- name: Make sure a file does not exist on managed hosts
  file:
    dest: /path/to/file
    state: absent
</code></pre>

<h4 id="toc_8">1.2.6 检索受管主机上的文件状态</h4>

<p><strong>stat</strong>模块检索文件的事实，类似于Linux中的<strong>stat</strong>命令。参数提供检索文件属性、确定文件检验和等功能。</p>

<p><strong>stat</strong>模块返回一个包含文件状态数据的值的散列字典，允许用户使用单独的变量引用各条信息。</p>

<p>以下示例注册<strong>stat</strong>模块的结果，然后显示它检查的文件的MD5检验和。</p>

<pre><code class="language-text">- name: Verify the checksum of a file
  stat:
    path: /path/to/file
    checksum_algorithm: md5
  register: result
  
- debug
  msg: &quot;The checksum of the file is {{ result.stat.checksum }}&quot;
</code></pre>

<p>有关<strong>stat</strong>模块返回的值的信息由<strong>ansible-doc</strong>记录，或者可以注册一个变量并显示其内容以查看可用内容：</p>

<pre><code class="language-text">- name: Examine all stat output of /etc/passwd
  hosts: 172.16.103.129
  
  tasks:
    - name: stat /etc/passwd
      stat:
        path: /etc/passwd
      register: results
      
    - name: Display stat results
      debug:
        var: results
</code></pre>

<h4 id="toc_9">1.2.7 同步控制节点和受管主机之间的文件</h4>

<p><strong>synchronize</strong>模块是一个围绕<strong>rsync</strong>工具的打包程序，它简化了<strong>playbook</strong>中的常见文件管理任务。<strong>rsync</strong>工具必须同时安装在本机和远程主机上。默认情况下，在使用<strong>synchronize</strong>模块时，“本地主机”是同步任务所源自的主机（通常是控制节点），而“目标主机”是<strong>synchronize</strong>连接到的主机。</p>

<p>以下示例将位于Ansible工作目录中的文件同步到受管主机：</p>

<pre><code class="language-text">- name: synchronize local file to remote files
  synchronize:
    src: file
    dest: /path/to/file
</code></pre>

<p>有很多种方法可以使用<strong>synchronize</strong>模块及其许多参数，包括同步目录。运行<strong>ansible-doc synchronize</strong>命令查看其他参数和playbook示例。</p>

<h2 id="toc_10">2. 使用jinja2模板部署自定义文件</h2>

<h3 id="toc_11">2.1 jinja2简介</h3>

<p>Ansible将<strong>jinja2</strong>模板系统用于模板文件。Ansible还使用<strong>jinja2</strong>语法来引用<strong>playbook</strong>中的变量。</p>

<p>变量和逻辑表达式置于标记或分隔符之间。例如，jinja2模板将<strong>{% EXPR %}</strong>用于表达式或逻辑（如循环），而<strong>{{ EXPR }}</strong>则用于向最终用户输出表达式或变量的结果。后一标记在呈现时将被替换为一个或多个值，对最终用户可见。使用<strong>{# COMMENT #}</strong>语法括起不应出现在最终文件中的注释。</p>

<p>在下例中，第一行中含有不会包含于最终文件中的注释。第二行中引用的变量被替换为所引用的系统事实的值。</p>

<pre><code class="language-text">{# /etc/hosts line #}
{{ ansible_facts[&#39;default_ipv4&#39;][&#39;address&#39;] }}      {{ ansible_facts[&#39;hostname&#39;] }}
</code></pre>

<h3 id="toc_12">2.2 构建jinja2模板</h3>

<p><strong>jinja2</strong>模板由多个元素组成：数据、变量和表达式。在呈现<strong>jinja2</strong>模板时，这些变量和表达式被替换为对应的值。模板中使用的变量可以在<strong>playbook</strong>的<strong>vars</strong>部分中指定。可以将受管主机的事实用作模板中的变量。</p>

<p>请记住，可以使用<strong>ansible system_hostname -i inventory_file -m setup</strong>命令来获取与受管主机相关的事实。</p>

<p>下例演示了如何使用变量及Ansible从受管主机检索的事实创建<strong>/etc/ssh/sshd_config</strong>的模板。当执行相关的<strong>playbook</strong>时，任何事实都将被替换为所配置的受管主机中对应的值。</p>

<p>注意：包含<strong>jinja2</strong>模板的文件不需要有任何特定的文件扩展名（如.j2）。但是，提供此类文件扩展名会让你更容易记住它是模板文件。</p>

<pre><code class="language-text"># {{ ansible_managed }}
# DO NOT MAKE LOCAL MODIFICATIONS TO THIS FILE AS THEY WILL BE LOST

Port {{ ssh_port }}
ListenAddress {{ ansible_facts[&#39;default_ipv4&#39;][&#39;address&#39;] }}

HostKey /etc/ssh/ssh_host_rsa_key
HostKey /etc/ssh/ssh_host_ecdsa_key
HostKey /etc/ssh/ssh_host_ed25519_key

SyslogFacility AUTHPRIV

PermitRootLogin {{ root_allowed }}
AllowGroups {{ groups_allowed }}

AuthorizedKeyFile /etc/.rht_authorized_keys .ssh/authorized_keys

PasswordAuthentication {{ passwords_allowed }}

ChallengeResponseAuthentication no

GSSAPIAuthentication yes
GSSAPICleanupCredentials no

UsePAM yes

X11Forwarding yes
UsePrivilegeSeparation sandbox

AcceptEnv LANG LC_CTYPE LC_NUMERIC LC_TIME LC_COLLATE LC_MONETARY LC_MESSAGES
AcceptEnv LC_PAPER LC_NAME LC_ADDRESS LC_TELEPHONE LC_MEASUREMENT
AcceptEnv LC_IDENTIFICATION LC_ALL LANGUAGE
AcceptEnv XMODIFIERS

Subsystem sftp /usr/libexec/openssh/sftp-server
</code></pre>

<h3 id="toc_13">2.3 部署jinja2模板</h3>

<p><strong>jinja2</strong>模板是功能强大的工具，可用于自定义要在受管主机上部署的配置文件。创建了适用于配置文件的<strong>jinja2</strong>模板后，它可以通过<strong>template</strong>模板部署到受管主机上，该模块支持将控制节点中的本地文件转移到受管主机。</p>

<p>若要使用<strong>template</strong>模块，请使用下列语法。与<strong>src</strong>键关联的值指定来源<strong>jinja2</strong>模板，而与<strong>dest</strong>键关联的值指定要在目标主机上创建的文件。</p>

<pre><code class="language-text">tasks:
  - name: template render
    template:
      src: /tmp/j2-template.j2
      dest: /tmp/dest-config-file.txt
</code></pre>

<p><strong>template</strong>模块还允许指定已部署文件的所有者、组、权限和SELINUX上下文，就像<strong>file</strong>模块一样。它也可以取用<strong>validate</strong>选项运行任意命令（如<strong>visudo -c</strong>），在将文件复制到位之前检查该文件的语法是否正确。</p>

<p>有关更多详细信息，请参阅<strong>ansible-doc template</strong></p>

<h3 id="toc_14">2.4 管理模板文件</h3>

<p>为避免系统管理员修改Ansible部署的文件，最好在模板顶部包含注释，以指示不应手动编辑该文件。</p>

<p>可使用<strong>ansible_managed</strong>指令中设置的&quot;<strong>Ansible managed</strong>&quot;字符串来执行此操作。这不是正常变量，但可以在模板中用作一个变量。<strong>ansible_managed</strong>指令在<strong>ansible.cfg</strong>文件中设置：</p>

<pre><code class="language-text">ansible_managed = Ansible managed
</code></pre>

<p>要将ansible_managed字符串包含在jinja2模板内，请使用下列语法：</p>

<pre><code class="language-text">{{ ansible_managed }}
</code></pre>

<h3 id="toc_15">2.5 控制结构</h3>

<p>用户可以在模板文件中使用<strong>jinja2</strong>控制结构，以减少重复输入，为<strong>play</strong>中的每个主机动态输入条目，或者有条件地将文本插入到文件中。</p>

<h4 id="toc_16">2.5.1 使用循环</h4>

<p><strong>jinja2</strong>使用<strong>for</strong>语句来提供循环功能。在下例中，<strong>user</strong>变量替换为<strong>users</strong>变量中包含的所有值，一行一个值。</p>

<pre><code class="language-text">{% for user in users %}
    {{ user }}
{% endfor %}
</code></pre>

<p>以下示例模板使用<strong>for</strong>语句逐一运行<strong>users</strong>变量中的所有值，将<strong>myuser</strong>替换为各个值，但值为<strong>root</strong>时除外。</p>

<pre><code class="language-text">{# for statement #}
{% for myuser in users if not myuser == &quot;root&quot; %}
User number {{ loop.index }} - {{ myuser }}
{% endfor %}
</code></pre>

<p><strong>loop.index</strong>变量扩展至循环当前所处的索引号。它在循环第一次执行时值为1，每一次迭代递增1。</p>

<p>再如，此模板也使用了<strong>for</strong>语句，并且假定使用的清单文件中已定义了<strong>myhosts</strong>变量。此变量将包含要管理的主机的列表。使用下列<strong>for</strong>语句时，文件中将列出清单<strong>myhosts</strong>组内的所有主机。</p>

<pre><code class="language-text">{% for myhost in groups[&#39;myhosts&#39;] %}
{{ myhost }}
{% endfor %}
</code></pre>

<p>举一个更实际的例子，用户可以使用该模板从主机事实动态生成<strong>/etc/hosts</strong>文件。假设playbook如下：</p>

<pre><code class="language-text">- name: /etc/hosts is up to date
  hosts: all
  gather_facts: yes
  tasks:
    - name: Deploy /etc/hosts
      template:
        src: templates/hosts.j2
        dest: /etc/hosts
</code></pre>

<p>下述三行<strong>templates/hosts.j2</strong>模板从<strong>all</strong>组中的所有主机构造文件。（由于变量名称的长度，模板的中间行非常长。）它迭代组中的每个主机以获得<strong>/etc/hosts</strong>文件的三个事实。</p>

<pre><code class="language-text">{% for host in groups[&#39;all&#39;] %}
{{ hostvars[&#39;host&#39;][&#39;ansible_facts&#39;][&#39;default_ipv4&#39;][&#39;address&#39;] }}      {{ hostvars[&#39;host&#39;][&#39;ansible_facts&#39;][&#39;fqdn&#39;] }}     {{ hostvars[&#39;host&#39;][&#39;ansible_facts&#39;][&#39;hostname&#39;] }}
{% endfor %}
</code></pre>

<h4 id="toc_17">2.5.2 使用条件句</h4>

<p><strong>jinja2</strong>使用<strong>if</strong>语句来提供条件控制。如果满足某些条件，这允许用户在已部署的文件中放置一行。</p>

<p>在以下示例中，仅当<strong>finished</strong>变量的值为<strong>True</strong>时，才可将<strong>result</strong>变量的值放入已部署的文件。</p>

<pre><code class="language-text">{% if finished %}
{{ result }}
{% endif %}
</code></pre>

<p><strong>注意，在Ansible模板中我们可以使用jinja2循环和条件，但不能在Ansible Playbook中使用。</strong></p>

<h4 id="toc_18">2.5.3 变量过滤器</h4>

<p><strong>jinja2</strong>提供了过滤器，更改模板表达式的输出格式（例如，输出到果JSON）。有适用于YAML和JSON等语言的过滤器。<strong>to_json</strong>过滤器使用JSON格式化表达式输出，<strong>to_yaml</strong>过滤器则使用YAML格式化表达式输出。</p>

<pre><code class="language-text">{{ output | to_json }}
{{ output | to_yaml }}
</code></pre>

<p>也有其他过滤器，如<strong>to_nice_json</strong>和<strong>to_nice_yaml</strong>过滤器，它们将表达式输出格式化为JSON或YAML等人类可读格式。</p>

<pre><code class="language-text">{{ output | to_nice_json }}
{{ output | to_nice_yaml }}
</code></pre>

<p><strong>from_json</strong>和<strong>from_yaml</strong>过滤器相应要求JSON或YAML格式的字符串，并对它们进行解析。</p>

<pre><code class="language-text">{{ output | from_json }}
{{ output | from_yaml }}
</code></pre>

<h4 id="toc_19">2.5.4 变量测试</h4>

<p>在Ansible Playbook中与<strong>when</strong>子句一同使用的表达式是<strong>jinja2</strong>表达式。用于测试返回值的内置Ansible测试包括<strong>failed</strong>、<strong>changed</strong>、<strong>successded</strong>和<strong>skipped</strong>。以下任务演示了如何在条件表达式内使用测试。</p>

<pre><code class="language-text">tasks:
...output omitted...
  - debug: msg=&quot;the execution was aborted&quot;
    when: returnvalue is failed
</code></pre>


</div>

<br /><br />
<hr />

<div class="row clearfix">
  <div class="large-6 columns">
	<div class="text-left" style="padding:15px 0px;">
		
	        <a href="15820930531496.html" tppabs="http://www.itwangqing.net.cn/15820930531496.html"  title="Previous Post: Dockerfile">&laquo; Dockerfile</a>
	    
	</div>
  </div>
  <div class="large-6 columns">
	<div class="text-right" style="padding:15px 0px;">
		
	        <a href="15396808887591.html" tppabs="http://www.itwangqing.net.cn/15396808887591.html" 
	        title="Next Post: Linux运维面试题">Linux运维面试题 &raquo;</a>
	    
	</div>
  </div>
</div>

<div class="row">
<div style="padding:0px 0.93em;" class="share-comments">

</div>
</div>
<script type="text/javascript">
	$(function(){
		var currentURL = '15909932604247.html'/*tpa=http://www.itwangqing.net.cn/15909932604247.html*/;
		$('#side-nav a').each(function(){
			if($(this).attr('href') == currentURL){
				$(this).parent().addClass('active');
			}
		});
	});
</script>  
</div></div>


<div class="page-bottom">
  <div class="row">
  <hr />
  <div class="small-9 columns">
  <p class="copyright">Copyright &copy; 2015
Powered by <a target="_blank" href="javascript:if(confirm('http://www.mweb.im/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.mweb.im/'" tppabs="http://www.mweb.im/">MWeb</a>,&nbsp; 
Theme used <a target="_blank" href="javascript:if(confirm('http://github.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://github.com/'" tppabs="http://github.com/">GitHub CSS</a>.</p>
  </div>
  <div class="small-3 columns">
  <p class="copyright text-right"><a href="#header">TOP</a></p>
  </div>
   
  </div>
</div>

        </section>
      </div>
    </div>
    
    
    <script src="foundation.min.js" tppabs="http://www.itwangqing.net.cn/asset/js/foundation.min.js"></script>
    <script src="foundation.offcanvas.js" tppabs="http://www.itwangqing.net.cn/asset/js/foundation/foundation.offcanvas.js"></script>
    <script>
      $(document).foundation();

     
    </script>
    


  </body>
</html>
