<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
    
  nginx - Linux学习站
  
  </title>
 <meta name="description" content="">
 <link href="atom.xml" rel="alternate" title="Linux学习站" type="application/atom+xml">
    <link rel="stylesheet" href="foundation.min.css" tppabs="http://www.itwangqing.net.cn/asset/css/foundation.min.css" />
    <link rel="stylesheet" href="docs.css" tppabs="http://www.itwangqing.net.cn/asset/css/docs.css" />

    <script src="modernizr.js" tppabs="http://www.itwangqing.net.cn/asset/js/vendor/modernizr.js"></script>
    <script src="jquery.js" tppabs="http://www.itwangqing.net.cn/asset/js/vendor/jquery.js"></script>
    <script src="highlight.pack.js" tppabs="http://www.itwangqing.net.cn/asset/highlightjs/highlight.pack.js"></script>
    <link href="github.css" tppabs="http://www.itwangqing.net.cn/asset/highlightjs/styles/github.css" media="screen, projection" rel="stylesheet" type="text/css">
    <script>hljs.initHighlightingOnLoad();</script>
    
  </head>
  <body class="antialiased hide-extras">
    
    <div class="marketing off-canvas-wrap" data-offcanvas>
      <div class="inner-wrap">


<nav class="top-bar docs-bar hide-for-small" data-topbar>

<div id="header">
    <h1><a href="index.html" tppabs="http://www.itwangqing.net.cn/index.html">Linux学习站</a></h1>
</div>

</nav>
        <nav class="tab-bar show-for-small">
  <a href="javascript:void(0)" class="left-off-canvas-toggle menu-icon">
    <span> &nbsp; Linux学习站</span>
  </a>
</nav>

<aside class="left-off-canvas-menu">
      <ul class="off-canvas-list">
      <li><a href="index.html" tppabs="http://www.itwangqing.net.cn/index.html">Home</a></li>
      
        <li class="divider"></li>
        <li><label>系统基础</label></li>

          
            <li><a title="Linux基础一" href="15309530058499.html" tppabs="http://www.itwangqing.net.cn/15309530058499.html">Linux基础一</a></li>
          
            <li><a title="Linux基础二" href="15329593343626.html" tppabs="http://www.itwangqing.net.cn/15329593343626.html">Linux基础二</a></li>
          
            <li><a title="Linux基础三" href="15329666111943.html" tppabs="http://www.itwangqing.net.cn/15329666111943.html">Linux基础三</a></li>
          

      
        <li class="divider"></li>
        <li><label>用户管理</label></li>

          
            <li><a title="用户和组管理" href="15309537287199.html" tppabs="http://www.itwangqing.net.cn/15309537287199.html">用户和组管理</a></li>
          
            <li><a title="权限管理" href="15334773924932.html" tppabs="http://www.itwangqing.net.cn/15334773924932.html">权限管理</a></li>
          

      
        <li class="divider"></li>
        <li><label>文本编辑</label></li>

          
            <li><a title="文本编辑之VIM" href="15334773649600.html" tppabs="http://www.itwangqing.net.cn/15334773649600.html">文本编辑之VIM</a></li>
          

      
        <li class="divider"></li>
        <li><label>进程管理</label></li>

          
            <li><a title="linux进程管理" href="15307008887372.html" tppabs="http://www.itwangqing.net.cn/15307008887372.html">linux进程管理</a></li>
          
            <li><a title="控制服务和守护进程" href="15308770808056.html" tppabs="http://www.itwangqing.net.cn/15308770808056.html">控制服务和守护进程</a></li>
          

      
        <li class="divider"></li>
        <li><label>网络管理</label></li>

          
            <li><a title="网络基础管理" href="15301749310671.html" tppabs="http://www.itwangqing.net.cn/15301749310671.html">网络基础管理</a></li>
          
            <li><a title="网络进阶管理" href="15304407617481.html" tppabs="http://www.itwangqing.net.cn/15304407617481.html">网络进阶管理</a></li>
          

      
        <li class="divider"></li>
        <li><label>软件管理</label></li>

          
            <li><a title="软件管理" href="15298462113678.html" tppabs="http://www.itwangqing.net.cn/15298462113678.html">软件管理</a></li>
          
            <li><a title="yum工具的使用" href="15297662988909.html" tppabs="http://www.itwangqing.net.cn/15297662988909.html">yum工具的使用</a></li>
          
            <li><a title="源码安装包管理" href="15299940709726.html" tppabs="http://www.itwangqing.net.cn/15299940709726.html">源码安装包管理</a></li>
          

      
        <li class="divider"></li>
        <li><label>磁盘管理</label></li>

          
            <li><a title="Linux系统磁盘管理" href="15300107229451.html" tppabs="http://www.itwangqing.net.cn/15300107229451.html">Linux系统磁盘管理</a></li>
          
            <li><a title="LVM管理" href="15301020706680.html" tppabs="http://www.itwangqing.net.cn/15301020706680.html">LVM管理</a></li>
          

      
        <li class="divider"></li>
        <li><label>计划任务</label></li>

          
            <li><a title="linux计划任务管理" href="15306026605931.html" tppabs="http://www.itwangqing.net.cn/15306026605931.html">linux计划任务管理</a></li>
          

      
        <li class="divider"></li>
        <li><label>shell脚本</label></li>

          
            <li><a title="shell脚本基础" href="15326519927588.html" tppabs="http://www.itwangqing.net.cn/15326519927588.html">shell脚本基础</a></li>
          
            <li><a title="shell脚本进阶" href="15326563612690.html" tppabs="http://www.itwangqing.net.cn/15326563612690.html">shell脚本进阶</a></li>
          
            <li><a title="正则表达式" href="15309531529503.html" tppabs="http://www.itwangqing.net.cn/15309531529503.html">正则表达式</a></li>
          

      
        <li class="divider"></li>
        <li><label>服务管理</label></li>

          
            <li><a title="openssh" href="15309540565109.html" tppabs="http://www.itwangqing.net.cn/15309540565109.html">openssh</a></li>
          
            <li><a title="NFS" href="15331149680339.html" tppabs="http://www.itwangqing.net.cn/15331149680339.html">NFS</a></li>
          
            <li><a title="samba" href="15332084684114.html" tppabs="http://www.itwangqing.net.cn/15332084684114.html">samba</a></li>
          
            <li><a title="ftp" href="15331235945908.html" tppabs="http://www.itwangqing.net.cn/15331235945908.html">ftp</a></li>
          
            <li><a title="httpd" href="15333747858558.html" tppabs="http://www.itwangqing.net.cn/15333747858558.html">httpd</a></li>
          
            <li><a title="rsync" href="15336422692695.html" tppabs="http://www.itwangqing.net.cn/15336422692695.html">rsync</a></li>
          
            <li><a title="mysql基础" href="15340549469789.html" tppabs="http://www.itwangqing.net.cn/15340549469789.html">mysql基础</a></li>
          
            <li><a title="mysql进阶" href="15340747137714.html" tppabs="http://www.itwangqing.net.cn/15340747137714.html">mysql进阶</a></li>
          
            <li><a title="mysql多实例部署" href="15574501454471.html" tppabs="http://www.itwangqing.net.cn/15574501454471.html">mysql多实例部署</a></li>
          
            <li><a title="lamp" href="15343825969129.html" tppabs="http://www.itwangqing.net.cn/15343825969129.html">lamp</a></li>
          
            <li><a title="mysql主从" href="15340760215942.html" tppabs="http://www.itwangqing.net.cn/15340760215942.html">mysql主从</a></li>
          
            <li><a title="监控服务zabbix部署" href="15344093145314.html" tppabs="http://www.itwangqing.net.cn/15344093145314.html">监控服务zabbix部署</a></li>
          
            <li><a title="nginx" href="15347293082090.html" tppabs="http://www.itwangqing.net.cn/15347293082090.html">nginx</a></li>
          
            <li><a title="cobbler" href="15348344859945.html" tppabs="http://www.itwangqing.net.cn/15348344859945.html">cobbler</a></li>
          
            <li><a title="版本控制gitlab" href="15350227215553.html" tppabs="http://www.itwangqing.net.cn/15350227215553.html">版本控制gitlab</a></li>
          
            <li><a title="tomcat" href="15350951162147.html" tppabs="http://www.itwangqing.net.cn/15350951162147.html">tomcat</a></li>
          
            <li><a title="kvm虚拟化" href="15397735724181.html" tppabs="http://www.itwangqing.net.cn/15397735724181.html">kvm虚拟化</a></li>
          
            <li><a title="keepalived高可用" href="15399319450072.html" tppabs="http://www.itwangqing.net.cn/15399319450072.html">keepalived高可用</a></li>
          
            <li><a title="mysql中间件proxysql实现mysql读写分离" href="15421935147049.html" tppabs="http://www.itwangqing.net.cn/15421935147049.html">mysql中间件proxysql实现mysql读写分离</a></li>
          
            <li><a title="开源堡垒机Jumpserver" href="15671624164646.html" tppabs="http://www.itwangqing.net.cn/15671624164646.html">开源堡垒机Jumpserver</a></li>
          
            <li><a title="haproxy" href="15833949737143.html" tppabs="http://www.itwangqing.net.cn/15833949737143.html">haproxy</a></li>
          

      
        <li class="divider"></li>
        <li><label>自动化运维工具ansible</label></li>

          
            <li><a title="01 Ansible介绍与安装" href="15899421412937.html" tppabs="http://www.itwangqing.net.cn/15899421412937.html">01 Ansible介绍与安装</a></li>
          
            <li><a title="02 部署Ansible" href="15899422975885.html" tppabs="http://www.itwangqing.net.cn/15899422975885.html">02 部署Ansible</a></li>
          
            <li><a title="03 ansible常用模块" href="15360459655433.html" tppabs="http://www.itwangqing.net.cn/15360459655433.html">03 ansible常用模块</a></li>
          
            <li><a title="04 playbook" href="15900337310825.html" tppabs="http://www.itwangqing.net.cn/15900337310825.html">04 playbook</a></li>
          
            <li><a title="05 管理变量、机密和事实" href="15902192327327.html" tppabs="http://www.itwangqing.net.cn/15902192327327.html">05 管理变量、机密和事实</a></li>
          
            <li><a title="06 实施任务控制" href="15904785155492.html" tppabs="http://www.itwangqing.net.cn/15904785155492.html">06 实施任务控制</a></li>
          
            <li><a title="07 在被管理节点上创建文件或目录" href="15909932604247.html" tppabs="http://www.itwangqing.net.cn/15909932604247.html">07 在被管理节点上创建文件或目录</a></li>
          
            <li><a title="08 管理大项目" href="15916866139753.html" tppabs="http://www.itwangqing.net.cn/15916866139753.html">08 管理大项目</a></li>
          

      
        <li class="divider"></li>
        <li><label>自动化运维工具saltstack</label></li>

          
            <li><a title="01 SaltStack入门" href="15505624542032.html" tppabs="http://www.itwangqing.net.cn/15505624542032.html">01 SaltStack入门</a></li>
          
            <li><a title="02 SaltStack之配置管理" href="15505739253069.html" tppabs="http://www.itwangqing.net.cn/15505739253069.html">02 SaltStack之配置管理</a></li>
          
            <li><a title="03 SaltStack之数据系统" href="15506476021123.html" tppabs="http://www.itwangqing.net.cn/15506476021123.html">03 SaltStack之数据系统</a></li>
          
            <li><a title="04 SaltStack常用的模块" href="15506647066554.html" tppabs="http://www.itwangqing.net.cn/15506647066554.html">04 SaltStack常用的模块</a></li>
          
            <li><a title="05 SaltStack之return与job管理" href="15518677780073.html" tppabs="http://www.itwangqing.net.cn/15518677780073.html">05 SaltStack之return与job管理</a></li>
          
            <li><a title="06 SaltStack之salt-ssh" href="15520269709477.html" tppabs="http://www.itwangqing.net.cn/15520269709477.html">06 SaltStack之salt-ssh</a></li>
          
            <li><a title="07 SaltStack进阶" href="15537606512093.html" tppabs="http://www.itwangqing.net.cn/15537606512093.html">07 SaltStack进阶</a></li>
          

      
        <li class="divider"></li>
        <li><label>docker</label></li>

          
            <li><a title="docker容器技术基础入门" href="15756156871621.html" tppabs="http://www.itwangqing.net.cn/15756156871621.html">docker容器技术基础入门</a></li>
          
            <li><a title="docker基础用法" href="15808961165162.html" tppabs="http://www.itwangqing.net.cn/15808961165162.html">docker基础用法</a></li>
          
            <li><a title="docker镜像管理基础" href="15809107453374.html" tppabs="http://www.itwangqing.net.cn/15809107453374.html">docker镜像管理基础</a></li>
          
            <li><a title="docker容器虚拟化" href="15811500963775.html" tppabs="http://www.itwangqing.net.cn/15811500963775.html">docker容器虚拟化</a></li>
          
            <li><a title="docker容器网络" href="15812176196320.html" tppabs="http://www.itwangqing.net.cn/15812176196320.html">docker容器网络</a></li>
          
            <li><a title="docker容器网络配置" href="15812236429133.html" tppabs="http://www.itwangqing.net.cn/15812236429133.html">docker容器网络配置</a></li>
          
            <li><a title="docker存储卷" href="15812406178865.html" tppabs="http://www.itwangqing.net.cn/15812406178865.html">docker存储卷</a></li>
          
            <li><a title="Dockerfile" href="15820930531496.html" tppabs="http://www.itwangqing.net.cn/15820930531496.html">Dockerfile</a></li>
          
            <li><a title="Docker Private Registry" href="15823545783647.html" tppabs="http://www.itwangqing.net.cn/15823545783647.html">Docker Private Registry</a></li>
          

      
        <li class="divider"></li>
        <li><label>作业题</label></li>

          
            <li><a title="vim练习" href="15312221747200.html" tppabs="http://www.itwangqing.net.cn/15312221747200.html">vim练习</a></li>
          
            <li><a title="基础练习" href="15308359538636.html" tppabs="http://www.itwangqing.net.cn/15308359538636.html">基础练习</a></li>
          
            <li><a title="系统管理基础综合练习" href="15312664196054.html" tppabs="http://www.itwangqing.net.cn/15312664196054.html">系统管理基础综合练习</a></li>
          
            <li><a title="shell脚本习题" href="15395707987789.html" tppabs="http://www.itwangqing.net.cn/15395707987789.html">shell脚本习题</a></li>
          
            <li><a title="Linux运维面试题" href="15396808887591.html" tppabs="http://www.itwangqing.net.cn/15396808887591.html">Linux运维面试题</a></li>
          

      
        <li class="divider"></li>
        <li><label>python</label></li>

          
            <li><a title="python介绍" href="15538297742581.html" tppabs="http://www.itwangqing.net.cn/15538297742581.html">python介绍</a></li>
          
            <li><a title="Python入门" href="15540177360572.html" tppabs="http://www.itwangqing.net.cn/15540177360572.html">Python入门</a></li>
          
            <li><a title="变量与字符编码" href="15615383234174.html" tppabs="http://www.itwangqing.net.cn/15615383234174.html">变量与字符编码</a></li>
          
            <li><a title="Python编程规范、运算符" href="15616166878859.html" tppabs="http://www.itwangqing.net.cn/15616166878859.html">Python编程规范、运算符</a></li>
          
            <li><a title="流程控制与格式化输出" href="15616375345555.html" tppabs="http://www.itwangqing.net.cn/15616375345555.html">流程控制与格式化输出</a></li>
          
            <li><a title="数据类型" href="15617044071511.html" tppabs="http://www.itwangqing.net.cn/15617044071511.html">数据类型</a></li>
          
            <li><a title="文件管理" href="15646303312857.html" tppabs="http://www.itwangqing.net.cn/15646303312857.html">文件管理</a></li>
          
            <li><a title="函数从入门到超神" href="15621339486509.html" tppabs="http://www.itwangqing.net.cn/15621339486509.html">函数从入门到超神</a></li>
          
            <li><a title="列表生成式、迭代器与生成器" href="15652344516454.html" tppabs="http://www.itwangqing.net.cn/15652344516454.html">列表生成式、迭代器与生成器</a></li>
          
            <li><a title="模块与包" href="15621538343767.html" tppabs="http://www.itwangqing.net.cn/15621538343767.html">模块与包</a></li>
          
            <li><a title="常用内置模块" href="15622250202368.html" tppabs="http://www.itwangqing.net.cn/15622250202368.html">常用内置模块</a></li>
          
            <li><a title="日志模块logging" href="15658313775832.html" tppabs="http://www.itwangqing.net.cn/15658313775832.html">日志模块logging</a></li>
          
            <li><a title="正则表达式re模块" href="15623206542335.html" tppabs="http://www.itwangqing.net.cn/15623206542335.html">正则表达式re模块</a></li>
          
            <li><a title="Python爬虫实战：链家二手房" href="15635212817346.html" tppabs="http://www.itwangqing.net.cn/15635212817346.html">Python爬虫实战：链家二手房</a></li>
          
            <li><a title="数据可视化分析" href="15632679626574.html" tppabs="http://www.itwangqing.net.cn/15632679626574.html">数据可视化分析</a></li>
          

      
      </ul>
    </aside>

<a class="exit-off-canvas" href="#"></a>

        <section id="main-content" role="main" class="scroll-container">

          <div class="row">
            <div class="large-3 medium-3 columns">
              <div class="hide-for-small">
                <div class="sidebar">
                <nav>
                  <ul id="side-nav" class="side-nav">

                    
                      <li class="side-title"><span>系统基础</span></li>
                        
                          <li><a title="Linux基础一" href="15309530058499.html" tppabs="http://www.itwangqing.net.cn/15309530058499.html">Linux基础一</a></li>
                        
                          <li><a title="Linux基础二" href="15329593343626.html" tppabs="http://www.itwangqing.net.cn/15329593343626.html">Linux基础二</a></li>
                        
                          <li><a title="Linux基础三" href="15329666111943.html" tppabs="http://www.itwangqing.net.cn/15329666111943.html">Linux基础三</a></li>
                        

                    
                      <li class="side-title"><span>用户管理</span></li>
                        
                          <li><a title="用户和组管理" href="15309537287199.html" tppabs="http://www.itwangqing.net.cn/15309537287199.html">用户和组管理</a></li>
                        
                          <li><a title="权限管理" href="15334773924932.html" tppabs="http://www.itwangqing.net.cn/15334773924932.html">权限管理</a></li>
                        

                    
                      <li class="side-title"><span>文本编辑</span></li>
                        
                          <li><a title="文本编辑之VIM" href="15334773649600.html" tppabs="http://www.itwangqing.net.cn/15334773649600.html">文本编辑之VIM</a></li>
                        

                    
                      <li class="side-title"><span>进程管理</span></li>
                        
                          <li><a title="linux进程管理" href="15307008887372.html" tppabs="http://www.itwangqing.net.cn/15307008887372.html">linux进程管理</a></li>
                        
                          <li><a title="控制服务和守护进程" href="15308770808056.html" tppabs="http://www.itwangqing.net.cn/15308770808056.html">控制服务和守护进程</a></li>
                        

                    
                      <li class="side-title"><span>网络管理</span></li>
                        
                          <li><a title="网络基础管理" href="15301749310671.html" tppabs="http://www.itwangqing.net.cn/15301749310671.html">网络基础管理</a></li>
                        
                          <li><a title="网络进阶管理" href="15304407617481.html" tppabs="http://www.itwangqing.net.cn/15304407617481.html">网络进阶管理</a></li>
                        

                    
                      <li class="side-title"><span>软件管理</span></li>
                        
                          <li><a title="软件管理" href="15298462113678.html" tppabs="http://www.itwangqing.net.cn/15298462113678.html">软件管理</a></li>
                        
                          <li><a title="yum工具的使用" href="15297662988909.html" tppabs="http://www.itwangqing.net.cn/15297662988909.html">yum工具的使用</a></li>
                        
                          <li><a title="源码安装包管理" href="15299940709726.html" tppabs="http://www.itwangqing.net.cn/15299940709726.html">源码安装包管理</a></li>
                        

                    
                      <li class="side-title"><span>磁盘管理</span></li>
                        
                          <li><a title="Linux系统磁盘管理" href="15300107229451.html" tppabs="http://www.itwangqing.net.cn/15300107229451.html">Linux系统磁盘管理</a></li>
                        
                          <li><a title="LVM管理" href="15301020706680.html" tppabs="http://www.itwangqing.net.cn/15301020706680.html">LVM管理</a></li>
                        

                    
                      <li class="side-title"><span>计划任务</span></li>
                        
                          <li><a title="linux计划任务管理" href="15306026605931.html" tppabs="http://www.itwangqing.net.cn/15306026605931.html">linux计划任务管理</a></li>
                        

                    
                      <li class="side-title"><span>shell脚本</span></li>
                        
                          <li><a title="shell脚本基础" href="15326519927588.html" tppabs="http://www.itwangqing.net.cn/15326519927588.html">shell脚本基础</a></li>
                        
                          <li><a title="shell脚本进阶" href="15326563612690.html" tppabs="http://www.itwangqing.net.cn/15326563612690.html">shell脚本进阶</a></li>
                        
                          <li><a title="正则表达式" href="15309531529503.html" tppabs="http://www.itwangqing.net.cn/15309531529503.html">正则表达式</a></li>
                        

                    
                      <li class="side-title"><span>服务管理</span></li>
                        
                          <li><a title="openssh" href="15309540565109.html" tppabs="http://www.itwangqing.net.cn/15309540565109.html">openssh</a></li>
                        
                          <li><a title="NFS" href="15331149680339.html" tppabs="http://www.itwangqing.net.cn/15331149680339.html">NFS</a></li>
                        
                          <li><a title="samba" href="15332084684114.html" tppabs="http://www.itwangqing.net.cn/15332084684114.html">samba</a></li>
                        
                          <li><a title="ftp" href="15331235945908.html" tppabs="http://www.itwangqing.net.cn/15331235945908.html">ftp</a></li>
                        
                          <li><a title="httpd" href="15333747858558.html" tppabs="http://www.itwangqing.net.cn/15333747858558.html">httpd</a></li>
                        
                          <li><a title="rsync" href="15336422692695.html" tppabs="http://www.itwangqing.net.cn/15336422692695.html">rsync</a></li>
                        
                          <li><a title="mysql基础" href="15340549469789.html" tppabs="http://www.itwangqing.net.cn/15340549469789.html">mysql基础</a></li>
                        
                          <li><a title="mysql进阶" href="15340747137714.html" tppabs="http://www.itwangqing.net.cn/15340747137714.html">mysql进阶</a></li>
                        
                          <li><a title="mysql多实例部署" href="15574501454471.html" tppabs="http://www.itwangqing.net.cn/15574501454471.html">mysql多实例部署</a></li>
                        
                          <li><a title="lamp" href="15343825969129.html" tppabs="http://www.itwangqing.net.cn/15343825969129.html">lamp</a></li>
                        
                          <li><a title="mysql主从" href="15340760215942.html" tppabs="http://www.itwangqing.net.cn/15340760215942.html">mysql主从</a></li>
                        
                          <li><a title="监控服务zabbix部署" href="15344093145314.html" tppabs="http://www.itwangqing.net.cn/15344093145314.html">监控服务zabbix部署</a></li>
                        
                          <li><a title="nginx" href="15347293082090.html" tppabs="http://www.itwangqing.net.cn/15347293082090.html">nginx</a></li>
                        
                          <li><a title="cobbler" href="15348344859945.html" tppabs="http://www.itwangqing.net.cn/15348344859945.html">cobbler</a></li>
                        
                          <li><a title="版本控制gitlab" href="15350227215553.html" tppabs="http://www.itwangqing.net.cn/15350227215553.html">版本控制gitlab</a></li>
                        
                          <li><a title="tomcat" href="15350951162147.html" tppabs="http://www.itwangqing.net.cn/15350951162147.html">tomcat</a></li>
                        
                          <li><a title="kvm虚拟化" href="15397735724181.html" tppabs="http://www.itwangqing.net.cn/15397735724181.html">kvm虚拟化</a></li>
                        
                          <li><a title="keepalived高可用" href="15399319450072.html" tppabs="http://www.itwangqing.net.cn/15399319450072.html">keepalived高可用</a></li>
                        
                          <li><a title="mysql中间件proxysql实现mysql读写分离" href="15421935147049.html" tppabs="http://www.itwangqing.net.cn/15421935147049.html">mysql中间件proxysql实现mysql读写分离</a></li>
                        
                          <li><a title="开源堡垒机Jumpserver" href="15671624164646.html" tppabs="http://www.itwangqing.net.cn/15671624164646.html">开源堡垒机Jumpserver</a></li>
                        
                          <li><a title="haproxy" href="15833949737143.html" tppabs="http://www.itwangqing.net.cn/15833949737143.html">haproxy</a></li>
                        

                    
                      <li class="side-title"><span>自动化运维工具ansible</span></li>
                        
                          <li><a title="01 Ansible介绍与安装" href="15899421412937.html" tppabs="http://www.itwangqing.net.cn/15899421412937.html">01 Ansible介绍与安装</a></li>
                        
                          <li><a title="02 部署Ansible" href="15899422975885.html" tppabs="http://www.itwangqing.net.cn/15899422975885.html">02 部署Ansible</a></li>
                        
                          <li><a title="03 ansible常用模块" href="15360459655433.html" tppabs="http://www.itwangqing.net.cn/15360459655433.html">03 ansible常用模块</a></li>
                        
                          <li><a title="04 playbook" href="15900337310825.html" tppabs="http://www.itwangqing.net.cn/15900337310825.html">04 playbook</a></li>
                        
                          <li><a title="05 管理变量、机密和事实" href="15902192327327.html" tppabs="http://www.itwangqing.net.cn/15902192327327.html">05 管理变量、机密和事实</a></li>
                        
                          <li><a title="06 实施任务控制" href="15904785155492.html" tppabs="http://www.itwangqing.net.cn/15904785155492.html">06 实施任务控制</a></li>
                        
                          <li><a title="07 在被管理节点上创建文件或目录" href="15909932604247.html" tppabs="http://www.itwangqing.net.cn/15909932604247.html">07 在被管理节点上创建文件或目录</a></li>
                        
                          <li><a title="08 管理大项目" href="15916866139753.html" tppabs="http://www.itwangqing.net.cn/15916866139753.html">08 管理大项目</a></li>
                        

                    
                      <li class="side-title"><span>自动化运维工具saltstack</span></li>
                        
                          <li><a title="01 SaltStack入门" href="15505624542032.html" tppabs="http://www.itwangqing.net.cn/15505624542032.html">01 SaltStack入门</a></li>
                        
                          <li><a title="02 SaltStack之配置管理" href="15505739253069.html" tppabs="http://www.itwangqing.net.cn/15505739253069.html">02 SaltStack之配置管理</a></li>
                        
                          <li><a title="03 SaltStack之数据系统" href="15506476021123.html" tppabs="http://www.itwangqing.net.cn/15506476021123.html">03 SaltStack之数据系统</a></li>
                        
                          <li><a title="04 SaltStack常用的模块" href="15506647066554.html" tppabs="http://www.itwangqing.net.cn/15506647066554.html">04 SaltStack常用的模块</a></li>
                        
                          <li><a title="05 SaltStack之return与job管理" href="15518677780073.html" tppabs="http://www.itwangqing.net.cn/15518677780073.html">05 SaltStack之return与job管理</a></li>
                        
                          <li><a title="06 SaltStack之salt-ssh" href="15520269709477.html" tppabs="http://www.itwangqing.net.cn/15520269709477.html">06 SaltStack之salt-ssh</a></li>
                        
                          <li><a title="07 SaltStack进阶" href="15537606512093.html" tppabs="http://www.itwangqing.net.cn/15537606512093.html">07 SaltStack进阶</a></li>
                        

                    
                      <li class="side-title"><span>docker</span></li>
                        
                          <li><a title="docker容器技术基础入门" href="15756156871621.html" tppabs="http://www.itwangqing.net.cn/15756156871621.html">docker容器技术基础入门</a></li>
                        
                          <li><a title="docker基础用法" href="15808961165162.html" tppabs="http://www.itwangqing.net.cn/15808961165162.html">docker基础用法</a></li>
                        
                          <li><a title="docker镜像管理基础" href="15809107453374.html" tppabs="http://www.itwangqing.net.cn/15809107453374.html">docker镜像管理基础</a></li>
                        
                          <li><a title="docker容器虚拟化" href="15811500963775.html" tppabs="http://www.itwangqing.net.cn/15811500963775.html">docker容器虚拟化</a></li>
                        
                          <li><a title="docker容器网络" href="15812176196320.html" tppabs="http://www.itwangqing.net.cn/15812176196320.html">docker容器网络</a></li>
                        
                          <li><a title="docker容器网络配置" href="15812236429133.html" tppabs="http://www.itwangqing.net.cn/15812236429133.html">docker容器网络配置</a></li>
                        
                          <li><a title="docker存储卷" href="15812406178865.html" tppabs="http://www.itwangqing.net.cn/15812406178865.html">docker存储卷</a></li>
                        
                          <li><a title="Dockerfile" href="15820930531496.html" tppabs="http://www.itwangqing.net.cn/15820930531496.html">Dockerfile</a></li>
                        
                          <li><a title="Docker Private Registry" href="15823545783647.html" tppabs="http://www.itwangqing.net.cn/15823545783647.html">Docker Private Registry</a></li>
                        

                    
                      <li class="side-title"><span>作业题</span></li>
                        
                          <li><a title="vim练习" href="15312221747200.html" tppabs="http://www.itwangqing.net.cn/15312221747200.html">vim练习</a></li>
                        
                          <li><a title="基础练习" href="15308359538636.html" tppabs="http://www.itwangqing.net.cn/15308359538636.html">基础练习</a></li>
                        
                          <li><a title="系统管理基础综合练习" href="15312664196054.html" tppabs="http://www.itwangqing.net.cn/15312664196054.html">系统管理基础综合练习</a></li>
                        
                          <li><a title="shell脚本习题" href="15395707987789.html" tppabs="http://www.itwangqing.net.cn/15395707987789.html">shell脚本习题</a></li>
                        
                          <li><a title="Linux运维面试题" href="15396808887591.html" tppabs="http://www.itwangqing.net.cn/15396808887591.html">Linux运维面试题</a></li>
                        

                    
                      <li class="side-title"><span>python</span></li>
                        
                          <li><a title="python介绍" href="15538297742581.html" tppabs="http://www.itwangqing.net.cn/15538297742581.html">python介绍</a></li>
                        
                          <li><a title="Python入门" href="15540177360572.html" tppabs="http://www.itwangqing.net.cn/15540177360572.html">Python入门</a></li>
                        
                          <li><a title="变量与字符编码" href="15615383234174.html" tppabs="http://www.itwangqing.net.cn/15615383234174.html">变量与字符编码</a></li>
                        
                          <li><a title="Python编程规范、运算符" href="15616166878859.html" tppabs="http://www.itwangqing.net.cn/15616166878859.html">Python编程规范、运算符</a></li>
                        
                          <li><a title="流程控制与格式化输出" href="15616375345555.html" tppabs="http://www.itwangqing.net.cn/15616375345555.html">流程控制与格式化输出</a></li>
                        
                          <li><a title="数据类型" href="15617044071511.html" tppabs="http://www.itwangqing.net.cn/15617044071511.html">数据类型</a></li>
                        
                          <li><a title="文件管理" href="15646303312857.html" tppabs="http://www.itwangqing.net.cn/15646303312857.html">文件管理</a></li>
                        
                          <li><a title="函数从入门到超神" href="15621339486509.html" tppabs="http://www.itwangqing.net.cn/15621339486509.html">函数从入门到超神</a></li>
                        
                          <li><a title="列表生成式、迭代器与生成器" href="15652344516454.html" tppabs="http://www.itwangqing.net.cn/15652344516454.html">列表生成式、迭代器与生成器</a></li>
                        
                          <li><a title="模块与包" href="15621538343767.html" tppabs="http://www.itwangqing.net.cn/15621538343767.html">模块与包</a></li>
                        
                          <li><a title="常用内置模块" href="15622250202368.html" tppabs="http://www.itwangqing.net.cn/15622250202368.html">常用内置模块</a></li>
                        
                          <li><a title="日志模块logging" href="15658313775832.html" tppabs="http://www.itwangqing.net.cn/15658313775832.html">日志模块logging</a></li>
                        
                          <li><a title="正则表达式re模块" href="15623206542335.html" tppabs="http://www.itwangqing.net.cn/15623206542335.html">正则表达式re模块</a></li>
                        
                          <li><a title="Python爬虫实战：链家二手房" href="15635212817346.html" tppabs="http://www.itwangqing.net.cn/15635212817346.html">Python爬虫实战：链家二手房</a></li>
                        
                          <li><a title="数据可视化分析" href="15632679626574.html" tppabs="http://www.itwangqing.net.cn/15632679626574.html">数据可视化分析</a></li>
                        

                    
                  </ul>
                </nav>
                </div>
              </div>
            </div>
            <div class="large-9 medium-9 columns">

 <div class="markdown-body">
<h1>nginx</h1>

<ul>
<li>
<a href="#toc_0">1. nginx简介</a>
</li>
<li>
<a href="#toc_1">2. nginx的特性与优点</a>
<ul>
<li>
<a href="#toc_2">2.1 nginx的特性</a>
</li>
<li>
<a href="#toc_3">2.2 nginx的优点</a>
</li>
</ul>
</li>
<li>
<a href="#toc_4">3. nginx的功能及应用类别</a>
<ul>
<li>
<a href="#toc_5">3.1 nginx的基本功能</a>
</li>
<li>
<a href="#toc_6">3.2 nginx的扩展功能</a>
</li>
<li>
<a href="#toc_7">3.3 nginx的应用类别</a>
</li>
</ul>
</li>
<li>
<a href="#toc_8">4. nginx的模块与工作原理</a>
<ul>
<li>
<a href="#toc_9">4.1 nginx的模块分类</a>
</li>
<li>
<a href="#toc_10">4.2 nginx的工作原理</a>
</li>
</ul>
</li>
<li>
<a href="#toc_11">5. nginx的安装与配置</a>
<ul>
<li>
<a href="#toc_12">5.1 nginx的安装</a>
</li>
<li>
<a href="#toc_13">5.2 nginx安装后配置</a>
</li>
</ul>
</li>
<li>
<a href="#toc_14">6 nginx的配置文件详解</a>
<ul>
<li>
<a href="#toc_15">6.1 nginx.conf配置详解</a>
</li>
<li>
<a href="#toc_16">6.2 用于调试、定位问题的配置参数</a>
</li>
<li>
<a href="#toc_17">6.3 正常运行必备的配置参数</a>
</li>
<li>
<a href="#toc_18">6.4 优化性能的配置参数</a>
</li>
<li>
<a href="#toc_19">6.5 事件相关的配置：event{}段中的配置参数</a>
</li>
<li>
<a href="#toc_20">6.6 网络连接相关的配置参数</a>
</li>
<li>
<a href="#toc_21">6.7 fastcgi的相关配置参数</a>
</li>
<li>
<a href="#toc_22">6.8 常需要进行调整的参数</a>
</li>
<li>
<a href="#toc_23">6.9 nginx作为web服务器时使用的配置：http{}段的配置参数</a>
</li>
<li>
<a href="#toc_24">6.10 访问控制</a>
</li>
<li>
<a href="#toc_25">6.11 基于用户认证</a>
</li>
<li>
<a href="#toc_26">6.12 https配置</a>
</li>
<li>
<a href="#toc_27">6.13 开启状态界面</a>
</li>
<li>
<a href="#toc_28">6.14 rewrite</a>
</li>
<li>
<a href="#toc_29">6.15 if</a>
<ul>
<li>
<a href="#toc_30">6.15.1 基于浏览器实现分离案例</a>
</li>
<li>
<a href="#toc_31">6.15.2 防盗链案例</a>
</li>
</ul>
</li>
<li>
<a href="#toc_32">6.16 反向代理与负载均衡</a>
</li>
</ul>
</li>
<li>
<a href="#toc_33">作业</a>
</li>
</ul>


<hr/>

<h2 id="toc_0">1. nginx简介</h2>

<p><code>nginx</code>（发音同engine x）是一款轻量级的Web服务器/反向代理服务器及电子邮件（IMAP/POP3）代理服务器，并在一个BSD-like协议下发行。</p>

<p><code>nginx</code>由俄罗斯的程序设计师Igor Sysoev所开发，最初供俄国大型的入口网站及搜寻引擎Rambler使用。</p>

<p>第一个公开版本0.1.0发布于2004年10月4日。其将源代码以类BSD许可证的形式发布，因它的稳定性、丰富的功能集、示例配置文件和低系统资源的消耗而闻名。2011年6月1日，nginx 1.0.4发布。</p>

<p><code>nginx</code>的特点是占有内存少，并发能力强，事实上<code>nginx</code>的并发能力确实在同类型的网页服务器中表现较好，中国大陆使用<code>nginx</code>网站用户有：百度、京东、新浪、网易、腾讯、淘宝等。</p>

<h2 id="toc_1">2. nginx的特性与优点</h2>

<h3 id="toc_2">2.1 nginx的特性</h3>

<p><code>nginx</code>是一个很牛的高性能Web和反向代理服务器，它具有很多非常优越的特性：</p>

<ul>
<li>在高连接并发的情况下，nginx是Apache服务器不错的替代品，能够支持高达50000个并发连接数的响应</li>
<li>使用epoll and kqueue作为开发模型</li>
<li>nginx作为负载均衡服务器：nginx既可在内部直接支持和PHP程序对外进行服务，也可支持作为HTTP代理服务器对外进行服务</li>
<li>nginx采用C进行编写，不论系统资源开销还是CPU使用效率都比Perlbal要好很多</li>
</ul>

<h3 id="toc_3">2.2 nginx的优点</h3>

<ul>
<li>高并发连接：官方测试能够支撑5万并发连接，在实际生产环境中跑到2-3万并发连接数</li>
<li>内存消耗少：在3万并发连接下，开启的10个nginx进程才消耗150M内存（15M*10=150M）</li>
<li>配置文件非常简单：风格跟程序一样通俗易懂</li>
<li>成本低廉：nginx为开源软件，可以免费使用。而购买F5 BIG-IP、NetScaler等硬件负载均衡交换机则需要十多万至几十万人民币</li>
<li>支持Rewrite重写规则：能够根据域名、URL的不同，将HTTP请求分到不同的后端服务器群组</li>
<li>内置的健康检查功能：如果Nginx Proxy后端的某台Web服务器宕机了，不会影响前端访问</li>
<li>节省带宽：支持GZIP压缩，可以添加浏览器本地缓存的Header头</li>
<li>稳定性高：用于反向代理，宕机的概率微乎其微</li>
<li>模块化设计：模块可以动态编译</li>
<li>外围支持好：文档全，二次开发和模块较多</li>
<li>支持热部署：可以不停机重载配置文件</li>
<li>支持事件驱动、AIO（AsyncIO，异步IO）、mmap（Memory Map，内存映射）等性能优化</li>
</ul>

<h2 id="toc_4">3. nginx的功能及应用类别</h2>

<h3 id="toc_5">3.1 nginx的基本功能</h3>

<ul>
<li>静态资源的web服务器，能缓存打开的文件描述符</li>
<li>http、smtp、pop3协议的反向代理服务器</li>
<li>缓存加速、负载均衡</li>
<li>支持FastCGI（fpm，LNMP），uWSGI（Python）等</li>
<li>模块化（非DSO机制），过滤器zip、SSI及图像的大小调整</li>
<li>支持SSL</li>
</ul>

<h3 id="toc_6">3.2 nginx的扩展功能</h3>

<ul>
<li>基于名称和IP的虚拟主机</li>
<li>支持keepalive</li>
<li>支持平滑升级</li>
<li>定制访问日志、支持使用日志缓冲区提高日志存储性能</li>
<li>支持URL重写</li>
<li>支持路径别名</li>
<li>支持基于IP及用户的访问控制</li>
<li>支持速率限制，支持并发数限制</li>
</ul>

<h3 id="toc_7">3.3 nginx的应用类别</h3>

<ul>
<li>使用nginx结合FastCGI运行PHP、JSP、Perl等程序</li>
<li>使用nginx作反向代理、负载均衡、规则过滤</li>
<li>使用nginx运行静态HTML网页、图片</li>
<li>nginx与其他新技术的结合应用</li>
</ul>

<h2 id="toc_8">4. nginx的模块与工作原理</h2>

<p><code>nginx</code>由内核和模块组成。其中，内核的设计非常微小和简洁，完成的工作也非常简单，仅仅通过查找配置文件将客户端请求映射到一个location block（location是nginx配置中的一个指令，用于URL匹配），而在这个location中所配置的每个指令将会启动不同的模块去完成相应的工作。</p>

<h3 id="toc_9">4.1 nginx的模块分类</h3>

<p>nginx的模块从结构上分为核心模块、基础模块和第三方模块</p>

<ul>
<li>HTTP模块、EVENT模块和MAIL模块等属于核心模块</li>
<li>HTTP Access模块、HTTP FastCGI模块、HTTP Proxy模块和HTTP Rewrite模块属于基本模块</li>
<li>HTTP Upstream模块、Request Hash模块、Notice模块和HTTP Access Key模块属于第三方模块</li>
</ul>

<p><strong>用户根据自己的需要开发的模块都属于第三方模块。正是有了如此多模块的支撑，nginx的功能才会如此强大</strong></p>

<p>nginx模块从功能上分为三类，分别是：</p>

<ul>
<li>Handlers（处理器模块）。此类模块直接处理请求，并进行输出内容和修改headers信息等操作。handlers处理器模块一般只能有一个</li>
<li>Filters（过滤器模块）。此类模块主要对其他处理器模块输出的内容进行修改操作，最后由nginx输出</li>
<li>Proxies（代理器模块）。就是nginx的HTTP Upstream之类的模块，这些模块主要与后端一些服务比如fastcgi等操作交互，实现服务代理和负载均衡等功能</li>
</ul>

<p>nginx模块分为：核心模块、事件模块、标准Http模块、可选Http模块、邮件模块、第三方模块和补丁等</p>

<ul>
<li>nginx基本模块：所谓基本模块，指的是nginx默认的功能模块，它们提供的指令，允许你使用定义nginx基本功能的变量，在编译时不能被禁用，包括：
<ul>
<li>核心模块：基本功能和指令，如进程管理和安全。常见的核心模块指令，大部分是放置在配置文件的顶部</li>
<li>事件模块：在Nginx内配置网络使用的能力。常见的events（事件）模块指令，大部分是放置在配置文件的顶部</li>
<li>配置模块：提供包含机制</li>
</ul></li>
</ul>

<p>具体的指令，请参考<code>nginx</code>的<a href="javascript:if(confirm('http://nginx.org/en/docs/ngx_core_module.html  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://nginx.org/en/docs/ngx_core_module.html'" tppabs="http://nginx.org/en/docs/ngx_core_module.html">官方文档</a></p>

<h3 id="toc_10">4.2 nginx的工作原理</h3>

<p><code>nginx</code>的模块直接被编译进<code>nginx</code>，因此属于静态编译方式。</p>

<p>启动<code>nginx</code>后，<code>nginx</code>的模块被自动加载，与<code>Apache</code>不一样，首先将模块编译为一个so文件，然后在配置文件中指定是否进行加载。</p>

<p>在解析配置文件时，<code>nginx</code>的每个模块都有可能去处理某个请求，但是同一个处理请求只能由一个模块来完成。</p>

<p><strong><code>nginx</code>的进程架构：</strong><br/>
启动<code>nginx</code>时，会启动一个<code>Master</code>进程，这个进程不处理任何客户端的请求，主要用来产生<code>worker</code>线程，一个<code>worker</code>线程用来处理n个<code>request</code>。<br/>
<center><img src="nginx_process.jpg" tppabs="http://itwangqing.net.cn/nginx_process.jpg" alt=""/></center><br/>
下图展示了<code>nginx</code>模块一次常规的HTTP请求和响应的过程<br/>
<center><img src="nginx_process_02.jpg" tppabs="http://itwangqing.net.cn/nginx_process_02.jpg" alt=""/></center><br/>
下图展示了基本的WEB服务请求步骤<br/>
<center><img src="nginx_process_01.jpg" tppabs="http://itwangqing.net.cn/nginx_process_01.jpg" alt=""/></center></p>

<h2 id="toc_11">5. nginx的安装与配置</h2>

<h3 id="toc_12">5.1 nginx的安装</h3>

<pre><code class="language-text">//创建系统用户nginx
[root@localhost ~]# useradd -r -M -s /sbin/nologin nginx

//安装依赖环境
[root@localhost ~]# yum -y install pcre-devel openssl openssl-devel gd-devel gcc gcc-c++
安装过程略....
[root@localhost ~]# yum -y groups mark install &#39;Development Tools&#39;
Loaded plugins: product-id, search-disabled-repos, subscription-manager
This system is not registered with an entitlement server. You can use subscription-manager to register.
There is no installed groups file.
Maybe run: yum groups mark convert (see man yum)
Marked install: Development Tools

//创建日志存放目录
[root@localhost ~]# mkdir -p /var/log/nginx
[root@localhost ~]# chown -R nginx.nginx /var/log/nginx

//下载nginx
[root@localhost ~]# cd /usr/src/
[root@localhost src]# wget http://nginx.org/download/nginx-1.12.0.tar.gz
--2018-08-20 11:19:09--  http://nginx.org/download/nginx-1.12.0.tar.gz
Resolving nginx.org (nginx.org)... 95.211.80.227, 206.251.255.63, 2606:7100:1:69::3f, ...
Connecting to nginx.org (nginx.org)|95.211.80.227|:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 980831 (958K) [application/octet-stream]
Saving to: ‘nginx-1.12.0.tar.gz’

100%[======================================================&gt;] 980,831     15.9KB/s   in 43s

2018-08-20 11:19:52 (22.3 KB/s) - ‘nginx-1.12.0.tar.gz’ saved [980831/980831]


//编译安装
[root@localhost src]# ls
debug  kernels  nginx-1.12.0.tar.gz
[root@localhost src]# tar xf nginx-1.12.0.tar.gz
[root@localhost src]# cd nginx-1.12.0
[root@localhost nginx-1.12.0]# ./configure \
--prefix=/usr/local/nginx \
--user=nginx \
--group=nginx \
--with-debug \
--with-http_ssl_module \
--with-http_realip_module \
--with-http_image_filter_module \
--with-http_gunzip_module \
--with-http_gzip_static_module \
--with-http_stub_status_module \
--http-log-path=/var/log/nginx/access.log \
--error-log-path=/var/log/nginx/error.log

[root@localhost nginx-1.12.0]# make -j $(grep &#39;processor&#39; /proc/cpuinfo | wc -l) &amp;&amp; make install
安装过程略....
</code></pre>

<h3 id="toc_13">5.2 nginx安装后配置</h3>

<pre><code class="language-text">//配置环境变量
[root@localhost ~]# echo &#39;export PATH=/usr/local/nginx/sbin:$PATH&#39; &gt; /etc/profile.d/nginx.sh
[root@localhost ~]# . /etc/profile.d/nginx.sh

//服务控制方式，使用nginx命令
    -t  //检查配置文件语法
    -v  //输出nginx的版本
    -c  //指定配置文件的路径
    -s  //发送服务控制信号，可选值有{stop|quit|reopen|reload}
    
//启动nginx
[root@localhost ~]# nginx
[root@localhost ~]# ss -antl
State      Recv-Q Send-Q   Local Address:Port                  Peer Address:Port
LISTEN     0      128                  *:80                               *:*
LISTEN     0      128                  *:22                               *:*
LISTEN     0      100          127.0.0.1:25                               *:*
LISTEN     0      128                 :::22                              :::*
LISTEN     0      100                ::1:25                              :::* 
</code></pre>

<h2 id="toc_14">6 nginx的配置文件详解</h2>

<p>主配置文件：/usr/local/nginx/conf/nginx.conf</p>

<ul>
<li>默认启动nginx时，使用的配置文件是：安装路径/conf/nginx.conf文件</li>
<li>可以在启动nginx时通过-c选项来指定要读取的配置文件</li>
</ul>

<p><strong><code>nginx</code>常见的配置文件及其作用</strong></p>

<table>
<thead>
<tr>
<th>配置文件</th>
<th>作用</th>
</tr>
</thead>

<tbody>
<tr>
<td>nginx.conf</td>
<td>nginx的基本配置文件</td>
</tr>
<tr>
<td>mime.types</td>
<td>MIME类型关联的扩展文件</td>
</tr>
<tr>
<td>fastcgi.conf</td>
<td>与fastcgi相关的配置</td>
</tr>
<tr>
<td>proxy.conf</td>
<td>与proxy相关的配置</td>
</tr>
<tr>
<td>sites.conf</td>
<td>配置nginx提供的网站，包括虚拟主机</td>
</tr>
</tbody>
</table>

<h3 id="toc_15">6.1 nginx.conf配置详解</h3>

<p>nginx.conf的内容分为以下几段：</p>

<ul>
<li>main配置段：全局配置段。其中main配置段中可能包含event配置段</li>
<li>event {}：定义event模型工作特性</li>
<li>http {}：定义http协议相关的配置</li>
</ul>

<p>配置指令：要以分号结尾，语法格式如下：</p>

<pre><code class="language-text">derective value1 [value2 ...];
</code></pre>

<p>支持使用变量：</p>

<ul>
<li>内置变量：模块会提供内建变量定义</li>
<li>自定义变量：<code>set var_name value</code></li>
</ul>

<h3 id="toc_16">6.2 用于调试、定位问题的配置参数</h3>

<pre><code class="language-text">daemon {on|off};    //是否以守护进程方式运行nginx，调试时应设置为off
master_process {on|off};    //是否以master/worker模型来运行nginx，调试时可以设置为off
error_log 位置 级别;    //配置错误日志
</code></pre>

<p>error_log里的位置和级别能有以下可选项：</p>

<table>
<thead>
<tr>
<th>位置</th>
<th>级别</th>
</tr>
</thead>

<tbody>
<tr>
<td>file<br>stderr<br>syslog:server=address[,parameter=value]<br>memory:size</td>
<td>debug：若要使用debug级别，需要在编译nginx时使用--with-debug选项<br>info<br>notice<br>warn<br>error<br>crit<br>alert<br>emerg</td>
</tr>
</tbody>
</table>

<h3 id="toc_17">6.3 正常运行必备的配置参数</h3>

<pre><code class="language-text">user USERNAME [GROUPNAME];    //指定运行worker进程的用户和组
pid /path/to/pid_file;    //指定nginx守护进程的pid文件
worker_rlimit_nofile number;    //设置所有worker进程最大可以打开的文件数，默认为1024
worker_rlimit_core size;    //指明所有worker进程所能够使用的总体的最大核心文件大小，保持默认即可
</code></pre>

<h3 id="toc_18">6.4 优化性能的配置参数</h3>

<pre><code class="language-text">worker_processes n;    //启动n个worker进程，这里的n为了避免上下文切换，通常设置为cpu总核心数-1或等于总核心数
worker_cpu_affinity cpumask ...;    //将进程绑定到某cpu中，避免频繁刷新缓存
//cpumask：使用8位二进制表示cpu核心，如：
    0000 0001   //第一颗cpu核心
    0000 0010   //第二颗cpu核心
    0000 0100   //第三颗cpu核心
    0000 1000   //第四颗cpu核心
    0001 0000   //第五颗cpu核心
    0010 0000   //第六颗cpu核心
    0100 0000   //第七颗cpu核心
    1000 0000   //第八颗cpu核心
timer_resolution interval;    //计时器解析度。降低此值，可减少gettimeofday()系统调用的次数
worker_priority number;    //指明worker进程的nice值
</code></pre>

<h3 id="toc_19">6.5 事件相关的配置：event{}段中的配置参数</h3>

<pre><code class="language-text">accept_mutex {off|on};    //master调度用户请求至各worker进程时使用的负载均衡锁；on表示能让多个worker轮流地、序列化地去响应新请求
lock_file file;    //accept_mutex用到的互斥锁锁文件路径
use [epoll | rtsig | select | poll];    //指明使用的事件模型，建议让nginx自行选择
worker_connections #;    //每个进程能够接受的最大连接数
</code></pre>

<h3 id="toc_20">6.6 网络连接相关的配置参数</h3>

<pre><code class="language-text">keepalive_timeout number;    //长连接的超时时长，默认为65s
keepalive_requests number;    //在一个长连接上所能够允许请求的最大资源数
keepalive_disable [msie6|safari|none];    //为指定类型的UserAgent禁用长连接
tcp_nodelay on|off;    //是否对长连接使用TCP_NODELAY选项，为了提升用户体验，通常设为on
client_header_timeout number;    //读取http请求报文首部的超时时长
client_body_timeout number;    //读取http请求报文body部分的超时时长
send_timeout number;    //发送响应报文的超时时长
</code></pre>

<h3 id="toc_21">6.7 fastcgi的相关配置参数</h3>

<p>LNMP：php要启用fpm模型<br/>
配置示例如下：</p>

<pre><code class="language-text">location ~ \.php$ {
  root html;
  fastcgi_pass 127.0.0.1:9000;      //定义反向代理
  fastcgi_index index.php;
  fastcgi_param SCRIPT_FILENAME /scripts$fastcgi_script_name;
  include fastcgi_params;
}
</code></pre>

<h3 id="toc_22">6.8 常需要进行调整的参数</h3>

<ul>
<li>worker_processes</li>
<li>worker_connections</li>
<li>worker_cpu_affinity</li>
<li>worker_priority</li>
</ul>

<h3 id="toc_23">6.9 nginx作为web服务器时使用的配置：http{}段的配置参数</h3>

<p>http{...}：配置http相关，由ngx_http_core_module模块引入。nginx的HTTP配置主要包括四个区块，结构如下：</p>

<pre><code class="language-text">http {//协议级别
  include mime.types;
  default_type application/octet-stream;
  keepalive_timeout 65;
  gzip on;
  upstream {//负载均衡配置
    ...
  }
  server {//服务器级别，每个server类似于httpd中的一个&lt;VirtualHost&gt;
    listen 80;
    server_name localhost;
    location / {//请求级别，类似于httpd中的&lt;Location&gt;，用于定义URL与本地文件系统的映射关系
      root html;
      index index.html index.htm;
    }
  }
}
</code></pre>

<p><strong>http{}段配置指令：</strong><br/>
server {}：定义一个虚拟主机，示例如下：</p>

<pre><code class="language-text">server {
  listen 80;
  server_name www.idfsoft.com;
  root &quot;/vhosts/web&quot;;
}
</code></pre>

<p>listen：指定监听的地址和端口</p>

<pre><code class="language-text">listen address[:port];
listen port;
</code></pre>

<p><code>server_name NAME [...];</code>  后面可跟多个主机，名称可使用正则表达式或通配符</p>

<p><strong>当有多个server时，匹配顺序如下：</strong></p>

<ol>
<li>先做精确匹配检查</li>
<li>左侧通配符匹配检查，如<code>*.idfsoft.com</code></li>
<li>右侧通配符匹配检查，如<code>mail.*</code></li>
<li>正则表达式匹配检查，如<code>~ ^.*\.idfsoft\.com$</code></li>
<li>default_server</li>
</ol>

<p><code>root path;</code>  设置资源路径映射，用于指明请求的URL所对应的资源所在的文件系统上的起始路径</p>

<p><code>alias path;</code>  用于location配置段，定义路径别名</p>

<p><code>index file;</code>   默认主页面</p>

<pre><code class="language-text">index index.php index.html;
</code></pre>

<p><code>error_page code [...] [=code] URI | @name</code>    根据http响应状态码来指明特用的错误页面，例如 <code>error_page 404 /404_customed.html</code></p>

<p>[=code]：以指定的响应码进行响应，而不是默认的原来的响应，默认表示以新资源的响应码为其响应码，例如 <code>error_page 404 =200 /404_customed.html</code></p>

<p><code>log_format</code>    定义日志格式</p>

<pre><code class="language-text">log_format  main  &#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;
                    &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;
                    &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;
access_log  logs/access.log  main;

//注意：此处可用变量为nginx各模块内建变量
</code></pre>

<p><strong>location区段，通过指定模式来与客户端请求的URI相匹配</strong></p>

<pre><code class="language-text">//功能：允许根据用户请求的URI来匹配定义的各location，匹配到时，此请求将被相应的location配置块中的配置所处理，例如做访问控制等功能

//语法：location [ 修饰符 ] pattern {......}
</code></pre>

<p><strong>常用修饰符说明：</strong></p>

<table>
<thead>
<tr>
<th style="text-align: center">修饰符</th>
<th>功能</th>
</tr>
</thead>

<tbody>
<tr>
<td style="text-align: center">=</td>
<td>精确匹配</td>
</tr>
<tr>
<td style="text-align: center">~</td>
<td>正则表达式模式匹配，区分大小写</td>
</tr>
<tr>
<td style="text-align: center">~*</td>
<td>正则表达式模式匹配，不区分大小写</td>
</tr>
<tr>
<td style="text-align: center">^~</td>
<td>前缀匹配，类似于无修饰符的行为，也是以指定模块开始，不同的是，如果模式匹配，那么就停止搜索其他模式了，不支持正则表达式</td>
</tr>
<tr>
<td style="text-align: center">@</td>
<td>定义命名location区段，这些区段客户端不能访问，只可以由内部产生的请求来访问，如try_files或error_page等</td>
</tr>
</tbody>
</table>

<p><strong>没有修饰符表示必须以指定模式开始</strong>，如：</p>

<pre><code class="language-text">server {
  server_name www.idfsoft.com;
  location /abc {
    ......
  }
}
</code></pre>

<p>那么如下内容就可正确匹配：</p>

<ul>
<li><a href="javascript:if(confirm('http://www.idfsoft.com/abc  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.idfsoft.com/abc'" tppabs="http://www.idfsoft.com/abc">http://www.idfsoft.com/abc</a></li>
<li><a href="javascript:if(confirm('http://www.idfsoft.com/abc?p1=11&p2=22  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.idfsoft.com/abc?p1=11&p2=22'" tppabs="http://www.idfsoft.com/abc?p1=11&p2=22">http://www.idfsoft.com/abc?p1=11&amp;p2=22</a></li>
<li><a href="javascript:if(confirm('http://www.idfsoft.com/abc/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.idfsoft.com/abc/'" tppabs="http://www.idfsoft.com/abc/">http://www.idfsoft.com/abc/</a></li>
</ul>

<p><strong>=：表示必须与指定的模式精确匹配</strong>，如：</p>

<pre><code class="language-text">server {
  server_name www.idfsoft.com;
  location = /abc {
    ......
  }
}
</code></pre>

<p>那么如下内容就可正确匹配：</p>

<ul>
<li><a href="javascript:if(confirm('http://www.idfsoft.com/abc  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.idfsoft.com/abc'" tppabs="http://www.idfsoft.com/abc">http://www.idfsoft.com/abc</a></li>
<li><a href="javascript:if(confirm('http://www.idfsoft.com/abc?p1=11&p2=22  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.idfsoft.com/abc?p1=11&p2=22'" tppabs="http://www.idfsoft.com/abc?p1=11&p2=22">http://www.idfsoft.com/abc?p1=11&amp;p2=22</a></li>
</ul>

<p>如下内容则无法匹配：</p>

<ul>
<li><a href="javascript:if(confirm('http://www.idfsoft.com/abc/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.idfsoft.com/abc/'" tppabs="http://www.idfsoft.com/abc/">http://www.idfsoft.com/abc/</a></li>
<li><a href="javascript:if(confirm('http://www.idfsoft.com/abc/abcde  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.idfsoft.com/abc/abcde'" tppabs="http://www.idfsoft.com/abc/abcde">http://www.idfsoft.com/abc/abcde</a></li>
</ul>

<p><strong>~：表示指定的正则表达式要区分大小写</strong>，如：</p>

<pre><code class="language-text">server {
  server_name www.idfsoft.com;
  location ~ ^/abc$ {
  ......
  }
}
</code></pre>

<p>那么如下内容就可正确匹配：</p>

<ul>
<li><a href="javascript:if(confirm('http://www.idfsoft.com/abc  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.idfsoft.com/abc'" tppabs="http://www.idfsoft.com/abc">http://www.idfsoft.com/abc</a></li>
<li><a href="javascript:if(confirm('http://www.idfsoft.com/abc?p1=11&p2=22  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.idfsoft.com/abc?p1=11&p2=22'" tppabs="http://www.idfsoft.com/abc?p1=11&p2=22">http://www.idfsoft.com/abc?p1=11&amp;p2=22</a></li>
</ul>

<p>如下内容则无法匹配：</p>

<ul>
<li><a href="javascript:if(confirm('http://www.idfsoft.com/abc/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.idfsoft.com/abc/'" tppabs="http://www.idfsoft.com/abc/">http://www.idfsoft.com/abc/</a></li>
<li><a href="javascript:if(confirm('http://www.idfsoft.com/ABC  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.idfsoft.com/ABC'" tppabs="http://www.idfsoft.com/ABC">http://www.idfsoft.com/ABC</a></li>
<li><a href="javascript:if(confirm('http://www.idfsoft.com/abcde  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.idfsoft.com/abcde'" tppabs="http://www.idfsoft.com/abcde">http://www.idfsoft.com/abcde</a></li>
</ul>

<p><strong>~*：表示指定的正则表达式不区分大小写</strong>，如：</p>

<pre><code class="language-text">server {
  server_name www.idfsoft.com;
  location ~* ^/abc$ {
    ......
  }
}
</code></pre>

<p>那么如下内容就可正确匹配：</p>

<ul>
<li><a href="javascript:if(confirm('http://www.idfsoft.com/abc  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.idfsoft.com/abc'" tppabs="http://www.idfsoft.com/abc">http://www.idfsoft.com/abc</a></li>
<li><a href="javascript:if(confirm('http://www.idfsoft.com/abc?p1=11&p2=22  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.idfsoft.com/abc?p1=11&p2=22'" tppabs="http://www.idfsoft.com/abc?p1=11&p2=22">http://www.idfsoft.com/abc?p1=11&amp;p2=22</a></li>
<li><a href="javascript:if(confirm('http://www.idfsoft.com/ABC  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.idfsoft.com/ABC'" tppabs="http://www.idfsoft.com/ABC">http://www.idfsoft.com/ABC</a></li>
</ul>

<p>如下内容则无法匹配：</p>

<ul>
<li><a href="javascript:if(confirm('http://www.idfsoft.com/abc/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.idfsoft.com/abc/'" tppabs="http://www.idfsoft.com/abc/">http://www.idfsoft.com/abc/</a></li>
<li><a href="javascript:if(confirm('http://www.idfsoft.com/abcde  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.idfsoft.com/abcde'" tppabs="http://www.idfsoft.com/abcde">http://www.idfsoft.com/abcde</a></li>
</ul>

<p><strong><sup>~：类似于无修饰符的行为，也是以指定模式开始，不同的是，如果模式匹配，则停止搜索其他模式</sup></strong></p>

<p><strong>查找顺序和优先级：由高到底依次为</strong></p>

<ol>
<li>带有<code>=</code>的精确匹配优先</li>
<li>正则表达式按照他们在配置文件中定义的顺序</li>
<li>带有<code>^~</code>修饰符的，开头匹配</li>
<li>带有<code>~</code>或<code>~*</code>修饰符的，如果正则表达式与URI匹配</li>
<li>没有修饰符的精确匹配</li>
</ol>

<p><strong>优先级次序如下：</strong></p>

<pre><code class="language-text">( location = 路径 ) --&gt; ( location ^~ 路径 ) --&gt; ( location ~ 正则 ) --&gt; ( location ~* 正则 ) --&gt; ( location 路径 )
</code></pre>

<h3 id="toc_24">6.10 访问控制</h3>

<p><strong>用于location段</strong><br/>
allow：设定允许哪台或哪些主机访问，多个参数间用空格隔开<br/>
deny：设定禁止哪台或哪些主机访问，多个参数间用空格隔开<br/>
示例：</p>

<pre><code class="language-text">allow 192.168.1.1/32 172.16.0.0/16;
deny all;
</code></pre>

<h3 id="toc_25">6.11 基于用户认证</h3>

<pre><code class="language-text">auth_basic &quot;欢迎信息&quot;;
auth_basic_user_file &quot;/path/to/user_auth_file&quot;
</code></pre>

<p>user_auth_file内容格式为：</p>

<pre><code class="language-text">username:password
</code></pre>

<p>这里的密码为加密后的密码串，建议用htpasswd来创建此文件：</p>

<pre><code class="language-text">htpasswd -c -m /path/to/.user_auth_file USERNAME
</code></pre>

<h3 id="toc_26">6.12 https配置</h3>

<p>生成私钥，生成证书签署请求并获得证书，然后在nginx.conf中配置如下内容：</p>

<pre><code class="language-text">server {
  listen       443 ssl;
  server_name  www.idfsoft.com;
  ssl_certificate      /etc/nginx/ssl/nginx.crt;
  ssl_certificate_key  /etc/nginx/ssl/nginx.key;
  ssl_session_cache    shared:SSL:1m;
  ssl_session_timeout  5m;
  ssl_ciphers  HIGH:!aNULL:!MD5;
  ssl_prefer_server_ciphers  on;
  location / {
    root   html;
    index  index.html index.htm;
  }
}
</code></pre>

<h3 id="toc_27">6.13 开启状态界面</h3>

<p>开启status：</p>

<pre><code class="language-text">location /status {
  stub_status {on | off};
  allow 172.16.0.0/16;
  deny all;
}
</code></pre>

<p>访问状态页面的方式：<code>http://server_ip/status</code></p>

<p><strong>状态页面信息详解：</strong></p>

<table>
<thead>
<tr>
<th style="text-align: center">状态码</th>
<th>表示的意义</th>
</tr>
</thead>

<tbody>
<tr>
<td style="text-align: center">Active connections 2</td>
<td>当前所有处于打开状态的连接数</td>
</tr>
<tr>
<td style="text-align: center">accepts</td>
<td>总共处理了多少个连接</td>
</tr>
<tr>
<td style="text-align: center">handled</td>
<td>成功创建多少握手</td>
</tr>
<tr>
<td style="text-align: center">requests</td>
<td>总共处理了多少个请求</td>
</tr>
<tr>
<td style="text-align: center">Reading</td>
<td>nginx读取到客户端的Header信息数，表示正处于接收请求状态的连接数</td>
</tr>
<tr>
<td style="text-align: center">Writing</td>
<td>nginx返回给客户端的Header信息数，表示请求已经接收完成，<br>且正处于处理请求或发送响应的过程中的连接数</td>
</tr>
<tr>
<td style="text-align: center">Waiting</td>
<td>开启keep-alive的情况下，这个值等于active - (reading + writing)，<br>意思就是Nginx已处理完正在等候下一次请求指令的驻留连接</td>
</tr>
</tbody>
</table>

<h3 id="toc_28">6.14 rewrite</h3>

<p>语法：<code>rewrite regex replacement flag;</code>，如：</p>

<pre><code class="language-text">rewrite ^/images/(.*\.jpg)$ /imgs/$1 break;
</code></pre>

<p>此处的$1用于引用(.*.jpg)匹配到的内容，又如：</p>

<pre><code class="language-text">rewrite ^/bbs/(.*)$ http://www.idfsoft.com/index.html redirect;
</code></pre>

<p>如上例所示，replacement可以是某个路径，也可以是某个URL</p>

<p><strong>常见的flag</strong></p>

<table>
<thead>
<tr>
<th style="text-align: center">flag</th>
<th>作用</th>
</tr>
</thead>

<tbody>
<tr>
<td style="text-align: center">last</td>
<td>基本上都用这个flag，表示当前的匹配结束，继续下一个匹配，最多匹配10个到20个<br>一旦此rewrite规则重写完成后，就不再被后面其它的rewrite规则进行处理<br>而是由UserAgent重新对重写后的URL再一次发起请求，并从头开始执行类似的过程</td>
</tr>
<tr>
<td style="text-align: center">break</td>
<td>中止Rewrite，不再继续匹配<br>一旦此rewrite规则重写完成后，由UserAgent对新的URL重新发起请求，<br>且不再会被当前location内的任何rewrite规则所检查</td>
</tr>
<tr>
<td style="text-align: center">redirect</td>
<td>以临时重定向的HTTP状态302返回新的URL</td>
</tr>
<tr>
<td style="text-align: center">permanent</td>
<td>以永久重定向的HTTP状态301返回新的URL</td>
</tr>
</tbody>
</table>

<p>rewrite模块的作用是用来执行URL重定向。这个机制有利于去掉恶意访问的url，也有利于搜索引擎优化（SEO）</p>

<p>nginx使用的语法源于Perl兼容正则表达式（PCRE）库，基本语法如下：</p>

<table>
<thead>
<tr>
<th style="text-align: center">标识符</th>
<th>意义</th>
</tr>
</thead>

<tbody>
<tr>
<td style="text-align: center">^</td>
<td>必须以^后的实体开头</td>
</tr>
<tr>
<td style="text-align: center">$</td>
<td>必须以$前的实体结尾</td>
</tr>
<tr>
<td style="text-align: center">.</td>
<td>匹配任意字符</td>
</tr>
<tr>
<td style="text-align: center">[]</td>
<td>匹配指定字符集内的任意字符</td>
</tr>
<tr>
<td style="text-align: center">[^]</td>
<td>匹配任何不包括在指定字符集内的任意字符串</td>
</tr>
<tr>
<td style="text-align: center">|</td>
<td>匹配 | 之前或之后的实体</td>
</tr>
<tr>
<td style="text-align: center">()</td>
<td>分组，组成一组用于匹配的实体，通常会有 | 来协助</td>
</tr>
</tbody>
</table>

<p>捕获子表达式，可以捕获放在()之间的任何文本，比如：</p>

<pre><code class="language-text">^(hello|sir)$       //字符串为“hi sir”捕获的结果：$1=hi$2=sir

//这些被捕获的数据，在后面就可以当变量一样使用了
</code></pre>

<h3 id="toc_29">6.15 if</h3>

<p>语法：<code>if (condition) {...}</code></p>

<p>应用场景：</p>

<ul>
<li>server段</li>
<li>location段</li>
</ul>

<p><strong>常见的condition</strong></p>

<ul>
<li>变量名（变量值为空串，或者以“0”开始，则为false，其它的均为true）</li>
<li>以变量为操作数构成的比较表达式（可使用=，!=类似的比较操作符进行测试）</li>
<li>正则表达式的模式匹配操作
<ul>
<li>~：区分大小写的模式匹配检查</li>
<li>~*：不区分大小写的模式匹配检查</li>
<li>!~和!~*：对上面两种测试取反</li>
</ul></li>
<li>测试指定路径为文件的可能性（-f，!-f)</li>
<li>测试指定路径为目录的可能性（-d，!-d）</li>
<li>测试文件的存在性（-e，!-e）</li>
<li>检查文件是否有执行权限（-x，!-x）</li>
</ul>

<h4 id="toc_30">6.15.1 基于浏览器实现分离案例</h4>

<pre><code class="language-text">if ($http_user_agent ~ Firefox) {
  rewrite ^(.*)$ /firefox/$1 break;
}

if ($http_user_agent ~ MSIE) {
  rewrite ^(.*)$ /msie/$1 break;
}

if ($http_user_agent ~ Chrome) {
  rewrite ^(.*)$ /chrome/$1 break;
}
</code></pre>

<h4 id="toc_31">6.15.2 防盗链案例</h4>

<pre><code class="language-text">location ~* \.(jpg|gif|jpeg|png)$ {
  valid_referers none blocked www.idfsoft.com;
  if ($invalid_referer) {
    rewrite ^/ http://www.idfsoft.com/403.html;
  }
}
</code></pre>

<h3 id="toc_32">6.16 反向代理与负载均衡</h3>

<p><code>nginx</code>通常被用作后端服务器的反向代理，这样就可以很方便的实现动静分离以及负载均衡，从而大大提高服务器的处理能力。</p>

<p><code>nginx</code>实现动静分离，其实就是在反向代理的时候，如果是静态资源，就直接从<code>nginx</code>发布的路径去读取，而不需要从后台服务器获取了。</p>

<p>但是要注意，这种情况下需要保证后端跟前端的程序保持一致，可以使用<code>Rsync</code>做服务端自动同步或者使用<code>NFS</code>、<code>MFS</code>分布式共享存储。</p>

<p><code>Http Proxy</code>模块，功能很多，最常用的是<code>proxy_pass</code>和<code>proxy_cache</code></p>

<p>如果要使用<code>proxy_cache</code>，需要集成第三方的<code>ngx_cache_purge</code>模块，用来清除指定的URL缓存。这个集成需要在安装<code>nginx</code>的时候去做，如：<br/>
<code>./configure --add-module=../ngx_cache_purge-1.0 ......</code></p>

<p><code>nginx</code>通过<code>upstream</code>模块来实现简单的负载均衡，<code>upstream</code>需要定义在<code>http</code>段内</p>

<p>在<code>upstream</code>段内，定义一个服务器列表，默认的方式是轮询，如果要确定同一个访问者发出的请求总是由同一个后端服务器来处理，可以设置ip_hash，如：</p>

<pre><code class="language-text">upstream idfsoft.com {
  ip_hash;
  server 127.0.0.1:9080 weight=5;
  server 127.0.0.1:8080 weight=5;
  server 127.0.0.1:1111;
}
</code></pre>

<p>注意：这个方法本质还是轮询，而且由于客户端的ip可能是不断变化的，比如动态ip，代理，翻墙等，因此ip_hash并不能完全保证同一个客户端总是由同一个服务器来处理。</p>

<p>定义好<code>upstream</code>后，需要在<code>server</code>段内添加如下内容：</p>

<pre><code class="language-text">server {
  location / {
    proxy_pass http://idfsoft.com;
  }
}
</code></pre>

<h2 id="toc_33">作业</h2>

<p>1.部署nginx<br/>
2.写博客<br/>
3.练习课堂上讲过的配置</p>


</div>

<br /><br />
<hr />

<div class="row clearfix">
  <div class="large-6 columns">
	<div class="text-left" style="padding:15px 0px;">
		
	        <a href="15646303312857.html" tppabs="http://www.itwangqing.net.cn/15646303312857.html"  title="Previous Post: 文件管理">&laquo; 文件管理</a>
	    
	</div>
  </div>
  <div class="large-6 columns">
	<div class="text-right" style="padding:15px 0px;">
		
	        <a href="15621339486509.html" tppabs="http://www.itwangqing.net.cn/15621339486509.html" 
	        title="Next Post: 函数从入门到超神">函数从入门到超神 &raquo;</a>
	    
	</div>
  </div>
</div>

<div class="row">
<div style="padding:0px 0.93em;" class="share-comments">

</div>
</div>
<script type="text/javascript">
	$(function(){
		var currentURL = '15347293082090.html'/*tpa=http://www.itwangqing.net.cn/15347293082090.html*/;
		$('#side-nav a').each(function(){
			if($(this).attr('href') == currentURL){
				$(this).parent().addClass('active');
			}
		});
	});
</script>  
</div></div>


<div class="page-bottom">
  <div class="row">
  <hr />
  <div class="small-9 columns">
  <p class="copyright">Copyright &copy; 2015
Powered by <a target="_blank" href="javascript:if(confirm('http://www.mweb.im/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://www.mweb.im/'" tppabs="http://www.mweb.im/">MWeb</a>,&nbsp; 
Theme used <a target="_blank" href="javascript:if(confirm('http://github.com/  \n\nļ޷ Teleport Ultra , Ϊ һ·ⲿΪʼַĵַ  \n\nڷϴ?'))window.location='http://github.com/'" tppabs="http://github.com/">GitHub CSS</a>.</p>
  </div>
  <div class="small-3 columns">
  <p class="copyright text-right"><a href="#header">TOP</a></p>
  </div>
   
  </div>
</div>

        </section>
      </div>
    </div>
    
    
    <script src="foundation.min.js" tppabs="http://www.itwangqing.net.cn/asset/js/foundation.min.js"></script>
    <script src="foundation.offcanvas.js" tppabs="http://www.itwangqing.net.cn/asset/js/foundation/foundation.offcanvas.js"></script>
    <script>
      $(document).foundation();

     
    </script>
    


  </body>
</html>
